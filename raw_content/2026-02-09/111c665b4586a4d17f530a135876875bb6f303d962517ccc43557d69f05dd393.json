{
  "title": "Can I finally start using Wayland in 2026?",
  "link": "https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/",
  "published": "2026-01-04T08:55:00+01:00",
  "summary": "<p>Wayland is the successor to the X server (X11, Xorg) to implement the graphics\nstack on Linux. The <a href=\"https://en.wikipedia.org/wiki/Wayland_(protocol)\">Wayland</a>\nproject was actually started in 2008, a year before I created the <a href=\"https://i3wm.org/\">i3 tiling\nwindow manager for X11</a> in 2009 ‚Äî but for the last 18 years\n(!), Wayland was never usable on my computers. I don‚Äôt want to be stuck on\ndeprecated software, so I try to start using Wayland each year, and this\narticles outlines what keeps me from migrating to Wayland in 2026.</p>\n<h2 id=\"historical-context\">Historical context</h2>\n<p>For the first few years, Wayland rarely even started on my machines. When I was\nlucky enough for something to show up, I could start some toy demo apps in the\ndemo compositor Weston.</p>\n<p>Around 2014, GNOME started supporting Wayland. KDE followed a few years later.\nMajor applications (like Firefox, Chrome or Emacs) have been slower to adopt\nWayland and needed users to opt into experimental implementations via custom\nflags or environment variables, until very recently, or ‚Äî in some cases, like\n<code>geeqie</code> ‚Äî still as of today.</p>\n<p>Unfortunately, the driver support situation remained poor for many years.  With\nnVidia graphics cards, which <a href=\"/posts/2017-12-11-dell-up3218k/\">are the only cards that support my 8K\nmonitor</a>, Wayland would either not work at all\nor exhibit heavy graphics glitches and crashes.</p>\n<p>In the 2020s, more and more distributions announced looking to switch to Wayland\nby default or even <a href=\"https://www.phoronix.com/news/Fedora-40-Eyes-No-X11-Session\">drop their X11\nsessions</a>, and RHEL\nis <a href=\"https://www.redhat.com/en/blog/rhel-10-plans-wayland-and-xorg-server\">winding down their contributions to the X\nserver</a>.</p>\n<p>Modern Linux distributions like <a href=\"https://asahilinux.org/\">Asahi Linux</a> (for\nMacs, with their own GPU driver!) clearly consider Wayland their primary desktop\nstack, and only support X11 on a best-effort basis.</p>\n<p>So the pressure to switch to Wayland is mounting! Is it ready now? What‚Äôs\nmissing?</p>\n<h2 id=\"making-wayland-start\">Making Wayland start</h2>\n<h3 id=\"wayland-hardware\">Hardware</h3>\n<p>I‚Äôm testing with my lab PC, which is a slightly upgraded version of <a href=\"/posts/2022-01-15-high-end-linux-pc/\">my 2022\nhigh-end Linux PC</a>.</p>\n<p>I describe my setup in more details in <a href=\"/posts/2020-05-23-desk-setup/\">stapelberg uses this: my 2020 desk\nsetup</a>.</p>\n<p>Most importantly for this article, I use a <a href=\"/posts/2017-12-11-dell-up3218k/\">Dell 8K 32&quot;\nmonitor</a> (resolution: 7680x4320!), which, in my\nexperience, is only compatible with nVidia graphics cards (I try other cards\nsometimes).</p>\n<p>Hence, both the lab PC and my main PC contain an nVidia GPU:</p>\n<ul>\n<li>The lab PC contains a nVidia GeForce RTX 4070 Ti.</li>\n<li>The main PC contains a nVidia GeForce RTX 3060 Ti.</li>\n</ul>\n<p>(In case you‚Äôre wondering why I use the older card in my PC: I had a crash once\nwhere I suspected the GPU, so I switched back from the 4070 to my older 3060.)</p>\n<h3 id=\"nvidia-driver-support\">nVidia driver support</h3>\n<p>For many years, nVidia drivers were entirely unsupported under Wayland.</p>\n<p>Apparently, nVidia refused to support the API that Wayland was using, insisting\nthat their EGLStreams approach was superior. Luckily, with nVidia driver 495\n(late 2021), they added support for GBM (Generic Buffer Manager).</p>\n<p>But, even with GBM support, while you could now start many Wayland sessions, the\nsession wouldn‚Äôt run smoothly: You would see severe graphics glitches and\nartifacts, preventing you from getting any work done.</p>\n<p>The solution for the glitches was <em>explicit sync</em> support: because the nVidia\ndriver does not support <em>implicit sync</em> (like AMD or Intel), Wayland (and\nwlroots, and sway) needed to get <a href=\"https://zamundaaa.github.io/wayland/2024/04/05/explicit-sync.html\">explicit sync\nsupport</a>.</p>\n<p>Sway 1.11 (June 2025) and wlroots 0.19.0 are the first version with explicit\nsync support.</p>\n<h3 id=\"tile\">Not working: TILE support for 8K monitor</h3>\n<p>With the nVidia driver now working <em>per se</em> with Wayland, unfortunately that‚Äôs\nstill not good enough to use Wayland in my setup: my <a href=\"/posts/2017-12-11-dell-up3218k/\">Dell UP3218K\nmonitor</a> requires two DisplayPort 1.4\nconnections with MST (Multi Stream Transport) and <code>TILE</code> support. This\ncombination worked just fine under X11 for the last 8+ years.</p>\n<p>While GNOME successfully configures the monitor with its native resolution of\n7680x4320@60, the monitor incorrectly shows up as two separate monitors in sway.</p>\n<p>The reason behind this behavior is that <a href=\"https://gitlab.freedesktop.org/wlroots/wlroots/-/issues/1580\">wlroots does not support the <code>TILE</code>\nproperty (issue #1580 from\n2019)</a>. Luckily,\nin 2023, contributor <code>EBADBEEF</code> sent <a href=\"https://gitlab.freedesktop.org/wlroots/wlroots/-/merge_requests/4154\">draft merge request\n!4154</a>,\nwhich adds support for the <code>TILE</code> property.</p>\n<p>But, even with the <code>TILE</code> patch, my monitor would not work correctly: The right\nhalf of the monitor would just stay black. The full picture is visible when\ntaking a screenshot with <code>grim</code>, so it seems like an output issue. I had a few\nexchanges about this with <code>EBADBEEF</code> starting in August 2025 (thanks for taking\na look!), but we couldn‚Äôt figure out the issue.</p>\n<p>A quarter later, I had made good experiences regarding debugging complex issues\nwith the coding assistant <a href=\"https://claude.com/product/claude-code\">Claude Code</a>\n(Opus 4.5 at the time of writing), so I decided to give it another try. Over two\ndays, I ran a number of tests to narrow down the issue, letting Claude analyze\nsource code (of sway, wlroots, Xorg, mesa, ‚Ä¶) and produce test programs that I\ncould run manually.</p>\n<p>Ultimately, I ended up with a minimal reproducer program (independent of\nWayland) that shows how the <code>SRC_X</code> DRM property does not work on nVidia (but\ndoes work on Intel, for example!): I posted a <a href=\"https://forums.developer.nvidia.com/t/bug-right-half-right-tile-of-my-8k-monitor-is-black-on-wlroots-based-wayland-compositors/355579\">bug report with a video in the\nnVidia\nforum</a>\nand hope an nVidia engineer will take a look!</p>\n<p>Crucially, with the bug now identified, I had Claude implement a workaround:\ncopy the right half of the screen (at <code>SRC_X=3840</code>) to another buffer, and then\ndisplay <em>that buffer</em>, but with <code>SRC_X=0</code>.</p>\n<p>With <a href=\"https://gitlab.freedesktop.org/wlroots/wlroots/-/merge_requests/4154#note_3249071\">that\npatch</a>\napplied, for the first time, I can use Sway on my 8K monitor! ü•≥</p>\n<hr />\n<p>By the way, when I mentioned that GNOME successfully configures the native\nresolution, that doesn‚Äôt mean the monitor is usable with GNOME! While GNOME\nsupports tiled displays, the updates of individual tiles are not synchronized,\nso you see heavy tearing in the middle of the screen, much worse than anything I\nhave ever observed under X11. GNOME/mutter <a href=\"https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/4822\">merge request\n!4822</a> should\nhopefully address this.</p>\n<h3 id=\"software-nixos\">Software: NixOS</h3>\n<p>During 2025, I <a href=\"/posts/tags/nix/\">switched all my computers to NixOS</a>. Its\ndeclarative approach is really nice for doing such tests, because you can\nreliably restore your system to an earlier version.</p>\n<p>To make a Wayland/sway session available on my NixOS 25.11 installation, I added\nthe following lines to my NixOS configuration file (<code>configuration.nix</code>):</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-nix\"><span style=\"display: flex;\"><span><span style=\"color: #60a0b0; font-style: italic;\"># GDM display manager (can launch both X11/i3 and Wayland/Sway sessions)</span>\n</span></span><span style=\"display: flex;\"><span>services<span style=\"color: #666;\">.</span>displayManager<span style=\"color: #666;\">.</span>gdm<span style=\"color: #666;\">.</span>enable <span style=\"color: #666;\">=</span> <span style=\"color: #60add5;\">true</span>;\n</span></span><span style=\"display: flex;\"><span>services<span style=\"color: #666;\">.</span>displayManager<span style=\"color: #666;\">.</span>gdm<span style=\"color: #666;\">.</span>autoSuspend <span style=\"color: #666;\">=</span> <span style=\"color: #60add5;\">false</span>;\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #60a0b0; font-style: italic;\"># enable GNOME (for testing)</span>\n</span></span><span style=\"display: flex;\"><span>services<span style=\"color: #666;\">.</span>desktopManager<span style=\"color: #666;\">.</span>gnome<span style=\"color: #666;\">.</span>enable <span style=\"color: #666;\">=</span> <span style=\"color: #60add5;\">true</span>;\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span>programs<span style=\"color: #666;\">.</span>sway <span style=\"color: #666;\">=</span> {\n</span></span><span style=\"display: flex;\"><span>  enable <span style=\"color: #666;\">=</span> <span style=\"color: #60add5;\">true</span>;\n</span></span><span style=\"display: flex;\"><span>  wrapperFeatures<span style=\"color: #666;\">.</span>gtk <span style=\"color: #666;\">=</span> <span style=\"color: #60add5;\">true</span>;\n</span></span><span style=\"display: flex;\"><span>  extraOptions <span style=\"color: #666;\">=</span> [ <span style=\"color: #4070a0;\">\"--unsupported-gpu\"</span> ];\n</span></span><span style=\"display: flex;\"><span>};\n</span></span></code></pre></div><p>I also added the following Wayland-specific programs to <code>environment.systemPackages</code>:</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-nix\"><span style=\"display: flex;\"><span>environment<span style=\"color: #666;\">.</span>systemPackages <span style=\"color: #666;\">=</span> <span style=\"color: #007020; font-weight: bold;\">with</span> pkgs; [\n</span></span><span style=\"display: flex;\"><span>  <span style=\"color: #60a0b0; font-style: italic;\"># ‚Ä¶</span>\n</span></span><span style=\"display: flex;\"><span>  foot          <span style=\"color: #60a0b0; font-style: italic;\"># terminal emulator</span>\n</span></span><span style=\"display: flex;\"><span>  wtype         <span style=\"color: #60a0b0; font-style: italic;\"># replacement for xdotool type</span>\n</span></span><span style=\"display: flex;\"><span>  fuzzel        <span style=\"color: #60a0b0; font-style: italic;\"># fuzzy matching program starter</span>\n</span></span><span style=\"display: flex;\"><span>  wayland-utils <span style=\"color: #60a0b0; font-style: italic;\"># for wayland-info(1)</span>\n</span></span><span style=\"display: flex;\"><span>  gammastep     <span style=\"color: #60a0b0; font-style: italic;\"># redshift replacement</span>\n</span></span><span style=\"display: flex;\"><span>];\n</span></span></code></pre></div><p>Note that activating this configuration kills your running X11 session, if any.</p>\n<p>Just to be sure, I rebooted the entire machine after changing the configuration.</p>\n<h2 id=\"results\">Experiment results</h2>\n<p>With this setup, I spent about one full work day in a Wayland session. Trying to\nactually get some work done uncovers issues that might not show in casual\ntesting. Most of the day was spent trying to fix Wayland issues üòÖ. The\nfollowing sections explain what I have learned/observed.</p>\n<h3 id=\"sway\">Desktop: i3 ‚Üí sway</h3>\n<p>Many years ago, when Wayland became more popular, people asked on the i3 issue\ntracker if i3 would be ported to Wayland. I said no: How could I port a program\nto an environment that doesn‚Äôt even run on any of my computers? But also, I knew\nthat with working a full-time job, I wouldn‚Äôt have time to be an early adopter\nand shape Wayland development.</p>\n<p>This attitude resulted in Drew DeVault starting the\n<a href=\"https://en.wikipedia.org/wiki/Sway_(window_manager)\">Sway</a> project around 2016,\nwhich aims to be a Wayland version of i3. I don‚Äôt see Sway as\ncompetition. Rather, I thought it was amazing that people liked the i3 project\nso much that they would go through the trouble of creating a similar program for\nother environments! What a nice compliment! üòä</p>\n<p>Sway aims to be compatible with i3 configuration files, and it mostly is.</p>\n<p>If you‚Äôre curious, here is what I changed from the Sway defaults, mostly moving\nkey bindings around for the <a href=\"https://neo-layout.org/\">NEO keyboard layout</a> I\nuse, and configuring <code>input</code>/<code>output</code> blocks that I formerly configured in <a href=\"https://github.com/stapelberg/configfiles/blob/c896b138b2f50e1badf1ee862678adb820d58473/xsession\">my\n<code>~/.xsession</code>\nfile</a>:</p>\n<details>\nmy changes to the default Sway config\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-diff\"><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">--- /home/michael/src/sway/config.in\t2025-09-24 19:08:38.876573260 +0200\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+++ /home/michael/.config/sway/config\t2025-12-31 15:50:38.616697542 +0100\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span><span style=\"color: #800080; font-weight: bold;\">@@ -9,19 +9,76 @@\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\"></span> # Logo key. Use Mod1 for Alt.\n</span></span><span style=\"display: flex;\"><span> set $mod Mod4\n</span></span><span style=\"display: flex;\"><span> # Home row direction keys, like vim\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-set $left h\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-set $down j\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-set $up k\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-set $right l\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+set $left n\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+set $down r\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+set $up t\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+set $right d\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> # Your preferred terminal emulator\n</span></span><span style=\"display: flex;\"><span> set $term foot\n</span></span><span style=\"display: flex;\"><span> # Your preferred application launcher\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-set $menu wmenu-run\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+set $menu fuzzel\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+font pango:Bitstream Vera Sans Mono 8\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+titlebar_padding 4 2\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+# Make Xwayland windows recognizeable:\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+for_window [shell=\"xwayland\"] title_format \"%title [Xwayland]\"\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+workspace_layout stacking\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+# Open two terminal windows side-by-side on new workspaces:\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+# https://github.com/stapelberg/workspace-populate-for-i3\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+exec ~/go/bin/workspace-populate-for-i3\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+exec gammastep -l 47.31:8.50 -b 0.9\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+input * {\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+   xkb_layout \"de\"\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+   xkb_variant \"neo\"\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\trepeat_delay 250\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\trepeat_rate 30\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+}\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+input * {\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\taccel_profile adaptive\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\tpointer_accel 0.2\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+}\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> \n</span></span><span style=\"display: flex;\"><span> ### Output configuration\n</span></span><span style=\"display: flex;\"><span> #\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-# Default wallpaper (more resolutions are available in @datadir@/backgrounds/sway/)\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-output * bg @datadir@/backgrounds/sway/Sway_Wallpaper_Blue_1920x1080.png fill\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+output * bg /dev/null fill #333333\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+output * scale 3\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> #\n</span></span><span style=\"display: flex;\"><span> # Example configuration:\n</span></span><span style=\"display: flex;\"><span> #\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\">@@ -33,14 +90,41 @@\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\"></span> #\n</span></span><span style=\"display: flex;\"><span> # Example configuration:\n</span></span><span style=\"display: flex;\"><span> #\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-# exec swayidle -w \\\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-#          timeout 300 'swaylock -f -c 000000' \\\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-#          timeout 600 'swaymsg \"output * power off\"' resume 'swaymsg \"output * power on\"' \\\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-#          before-sleep 'swaylock -f -c 000000'\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+exec swayidle -w \\\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+         before-sleep '~/swaylock.sh' \\\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+         lock '~/swaylock.sh'\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> #\n</span></span><span style=\"display: flex;\"><span> # This will lock your screen after 300 seconds of inactivity, then turn off\n</span></span><span style=\"display: flex;\"><span> # your displays after another 300 seconds, and turn your screens back on when\n</span></span><span style=\"display: flex;\"><span> # resumed. It will also lock your screen before your computer goes to sleep.\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+bindsym $mod+l exec loginctl lock-session\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+  # Notifications\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\">+  bindsym $mod+period exec dunstctl close\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> \n</span></span><span style=\"display: flex;\"><span> ### Input configuration\n</span></span><span style=\"display: flex;\"><span> #\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\">@@ -63,11 +147,13 @@\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\"></span>     # Start a terminal\n</span></span><span style=\"display: flex;\"><span>     bindsym $mod+Return exec $term\n</span></span><span style=\"display: flex;\"><span> \n</span></span><span style=\"display: flex;\"><span>     # Kill focused window\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    bindsym $mod+Shift+q kill\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+    bindsym $mod+Shift+x kill\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> \n</span></span><span style=\"display: flex;\"><span>     # Start your launcher\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    bindsym $mod+d exec $menu\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+    bindsym $mod+a exec $menu\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> \n</span></span><span style=\"display: flex;\"><span>     # Drag floating windows by holding down $mod and left mouse button.\n</span></span><span style=\"display: flex;\"><span>     # Resize them with right mouse button + $mod.\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\">@@ -142,12 +228,11 @@\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\"></span>     bindsym $mod+v splitv\n</span></span><span style=\"display: flex;\"><span> \n</span></span><span style=\"display: flex;\"><span>     # Switch the current container between different layout styles\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    bindsym $mod+s layout stacking\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+    bindsym $mod+i layout stacking\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span>     bindsym $mod+w layout tabbed\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    bindsym $mod+e layout toggle split\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span> \n</span></span><span style=\"display: flex;\"><span>     # Make the current focus fullscreen\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    bindsym $mod+f fullscreen\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+    bindsym $mod+e fullscreen\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> \n</span></span><span style=\"display: flex;\"><span>     # Toggle the current focus between tiling and floating mode\n</span></span><span style=\"display: flex;\"><span>     bindsym $mod+Shift+space floating toggle\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\">@@ -156,7 +241,7 @@\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\"></span>     bindsym $mod+space focus mode_toggle\n</span></span><span style=\"display: flex;\"><span> \n</span></span><span style=\"display: flex;\"><span>     # Move focus to the parent container\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    bindsym $mod+a focus parent\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+    bindsym $mod+u focus parent\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> #\n</span></span><span style=\"display: flex;\"><span> # Scratchpad:\n</span></span><span style=\"display: flex;\"><span> #\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\">@@ -192,37 +277,25 @@\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #800080; font-weight: bold;\"></span>     bindsym Return mode \"default\"\n</span></span><span style=\"display: flex;\"><span>     bindsym Escape mode \"default\"\n</span></span><span style=\"display: flex;\"><span> }\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-bindsym $mod+r mode \"resize\"\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+#bindsym $mod+r mode \"resize\"\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> \n</span></span><span style=\"display: flex;\"><span> #\n</span></span><span style=\"display: flex;\"><span> # Status Bar:\n</span></span><span style=\"display: flex;\"><span> #\n</span></span><span style=\"display: flex;\"><span> # Read `man 5 sway-bar` for more information about this section.\n</span></span><span style=\"display: flex;\"><span> bar {\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    position top\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span> \n</span></span><span style=\"display: flex;\"><span>     # When the status_command prints a new line to stdout, swaybar updates.\n</span></span><span style=\"display: flex;\"><span>     # The default just shows the current date and time.\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\">-    status_command while date +'%Y-%m-%d %X'; do sleep 1; done\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #a00000;\"></span><span style=\"color: #00a000;\">+    status_command i3status\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #00a000;\"></span> }\n</span></span><span style=\"display: flex;\"><span> \n</span></span></code></pre></div></details>\n<p>I encountered the following issues with Sway:</p>\n<ol>\n<li>\n<p>I don‚Äôt know how I can configure the same libinput settings that I had\nbefore.  See <a href=\"xinput-list-props-mx-ergo.txt\"><code>xinput-list-props-mx-ergo.txt</code></a>\nfor what I have on X11. Sway‚Äôs available <code>accel_profile</code> settings do not seem\nto match what I used before.</p>\n</li>\n<li>\n<p>The mouse cursor / pointer seems laggy, somehow?! It seems to take longer to\nreact when I move the trackball, and it also seems to move less smoothly\nacross the screen.</p>\n<p><a href=\"https://github.com/emersion\">Simon Ser</a> suspects that this might be because\nhardware cursor support might not work with the nVidia drivers currently.</p>\n</li>\n<li>\n<p>No Xwayland scaling: programs started via Xwayland are blurry (by default) or\ndouble-scaled (when setting <code>Xft.dpi: 288</code>). This is a Sway-specific\nlimitation: <a href=\"https://pointieststick.com/2022/06/17/this-week-in-kde-non-blurry-xwayland-apps/\">KDE fixed this in\n2022</a>. From\n<a href=\"https://github.com/swaywm/sway/issues/2966\">Sway issue #2966</a>, I can tell\nthat Sway developers do not seem to like this approach for some reason, but\nthat‚Äôs <em>very unfortunate</em> for my migration: The backwards compatibility\noption of running older programs through Xwayland is effectively unavailable\nto me.</p>\n</li>\n<li>\n<p>Sometimes, keyboard shortcuts seem to be executed twice! Like, when I focused\nthe first of five Chrome windows in a stack and moved that window to another\nworkspace, <em>two windows</em> would be moved instead of one. I also see messages\nlike this one (not exactly correlated with the double-shortcut problem,\nthough):</p>\n<pre tabindex=\"0\"><code>[ERROR] [wlr] [libinput] event0  - https: kinT (kint36): client bug: event\nprocessing lagging behind by 32ms, your system is too slow\n</code></pre><p>‚Ä¶and that seems wrong to me. My <a href=\"/posts/2025-05-15-my-2025-high-end-linux-pc/\">high-end Linux\nPC</a> certainly isn‚Äôt slow by any\nmeasure.</p>\n</li>\n</ol>\n<h3 id=\"gtk-font-size\">GTK: Font size</h3>\n<p>When I first started GTK programs like GIMP or Emacs, I noticed all fonts were\nway too large! Apparently, I still had some scaling-related settings that I\nneeded to reset like so:</p>\n<pre tabindex=\"0\"><code>gsettings reset org.gnome.desktop.interface scaling-factor\ngsettings reset org.gnome.desktop.interface text-scaling-factor\n</code></pre><p>Debugging tip: Display GNOME settings using <code>dconf dump /</code> (stored in\n<code>~/.config/dconf</code>).</p>\n<h3 id=\"gtk-backend\">GTK: Backend</h3>\n<p>Some programs like <code>geeqie</code> apparently need an explicit <code>export GDK_BACKEND=wayland</code> environment variable, otherwise they run in\nXwayland. Weird.</p>\n<h3 id=\"font-rendering\">Font rendering</h3>\n<p>I also noticed that font rendering is different between X11 and Wayland! The\ndifference is visible in Chrome browser tab titles and the URL bar, for example:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/2026-01-03-chrome-wayland-x11.png\"><img height=\"219\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/2026-01-03-chrome-wayland-x11_hu_8822a57b2d4633df.png\" style=\"border: 1px solid #000;\" width=\"600\" /></a>\n\n\n\n<p>At first I thought that maybe Wayland defaults to different font-antialiasing\nand font-hinting settings, but I tried experimenting with the following settings\n(which default to <code>font-antialiasing=grayscale</code> and <code>font-hinting=slight</code>), but\ncouldn‚Äôt get things to render like they did before:</p>\n<pre tabindex=\"0\"><code>gsettings set org.gnome.desktop.interface font-antialiasing 'rgba'\ngsettings set org.gnome.desktop.interface font-hinting 'full'\n</code></pre><p><strong>Update</strong>: Thanks to\n<a href=\"https://fosstodon.org/@whynothugo/115836011150423009\">Hugo</a> for pointing out\nthat under Wayland, GTK3 ignores the <code>~/.config/gtk-3.0/settings.ini</code>\nconfiguration file and uses dconf exclusively! Setting the following dconf\nsetting makes the font rendering match:</p>\n<pre tabindex=\"0\"><code>gsettings set org.gnome.desktop.interface font-name 'Cantarell 11'\n</code></pre><h3 id=\"swaylock\">Screen locker: swaylock</h3>\n<p>The obvious replacement for <a href=\"http://i3wm.org/i3lock/\"><code>i3lock</code></a> is\n<a href=\"https://github.com/swaywm/swaylock\"><code>swaylock</code></a>.</p>\n<p>I quickly ran into a difference in architecture between the two programs:</p>\n<ul>\n<li>\n<p>i3lock shows a screen locker window. When you kill i3lock, the screen is\nunlocked.</p>\n</li>\n<li>\n<p>When you kill swaylock, you end up in a <em>Red Screen Of Death</em>.</p>\n<p>To get out of this state, you need to restart swaylock and unlock. You can\nunlock from the command line by sending <code>SIGUSR1</code> to the <code>swaylock</code> process.</p>\n</li>\n</ul>\n<p>This was very surprising to me, but is by (Wayland) design! See <a href=\"https://github.com/swaywm/sway/issues/7046\">Sway issue\n#7046</a> for details, and this quote from\nthe <a href=\"https://wayland.app/protocols/ext-session-lock-v1\"><code>ext-session-lock-v1</code> Wayland protocol</a>:</p>\n<blockquote>\n<p>&ldquo;The compositor must stop rendering and provide input to normal\nclients. Instead the compositor must blank all outputs with an opaque color\nsuch that their normal content is fully hidden.&rdquo;</p>\n</blockquote>\n<p>OK, so when you start <code>swaylock</code> via SSH for testing, remember to always unlock\ninstead of just cancelling <code>swaylock</code> with Ctrl+C. And hope it never crashes.</p>\n<p>I used to start <code>i3lock</code> via a wrapper script, which turns off the monitor\n(input wakes it up):</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-bash\"><span style=\"display: flex;\"><span><span style=\"color: #007020;\">#!/bin/sh\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #007020;\"></span><span style=\"color: #60a0b0; font-style: italic;\"># Turns on DPMS, mutes all output, locks the screen.</span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #60a0b0; font-style: italic;\"># Reverts all settings on unlock, or when killed.</span>\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span>revert<span style=\"color: #666;\">()</span> <span style=\"color: #666;\">{</span>\n</span></span><span style=\"display: flex;\"><span>    xset dpms <span style=\"color: #40a070;\">0</span> <span style=\"color: #40a070;\">0</span> <span style=\"color: #40a070;\">0</span>\n</span></span><span style=\"display: flex;\"><span>    pactl set-sink-mute @DEFAULT_SINK@ <span style=\"color: #40a070;\">0</span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #666;\">}</span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #007020;\">trap</span> revert SIGHUP SIGINT SIGTERM\n</span></span><span style=\"display: flex;\"><span>xset +dpms dpms <span style=\"color: #40a070;\">15</span> <span style=\"color: #40a070;\">15</span> <span style=\"color: #40a070;\">15</span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #666;\">(</span>sleep <span style=\"color: #40a070;\">1</span> <span style=\"color: #666;\">&amp;&amp;</span> xset dpms force off<span style=\"color: #666;\">)</span> &amp;\n</span></span><span style=\"display: flex;\"><span>pactl set-sink-mute @DEFAULT_SINK@ <span style=\"color: #40a070;\">1</span>\n</span></span><span style=\"display: flex;\"><span>i3lock --raw 3840x2160:rgb --image ~/i3lock-wallpaper-3840x2160.rgb -n \n</span></span><span style=\"display: flex;\"><span>revert\n</span></span></code></pre></div><p>With Wayland, the DPMS behavior has to be implemented differently, with <code>swayidle</code>:</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-bash\"><span style=\"display: flex;\"><span><span style=\"color: #007020;\">#!/bin/sh\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #007020;\"></span><span style=\"color: #60a0b0; font-style: italic;\"># Turns on DPMS, mutes all output, locks the screen.</span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #60a0b0; font-style: italic;\"># Reverts all settings on unlock, or when killed.</span>\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span>swayidle -w <span style=\"color: #4070a0; font-weight: bold;\">\\\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #4070a0; font-weight: bold;\"></span>  timeout <span style=\"color: #40a070;\">5</span> <span style=\"color: #4070a0;\">'swaymsg \"output * dpms off\"'</span> <span style=\"color: #4070a0; font-weight: bold;\">\\\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #4070a0; font-weight: bold;\"></span>  resume <span style=\"color: #4070a0;\">'swaymsg \"output * dpms on\"'</span> &amp;\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #bb60d5;\">swayidle</span><span style=\"color: #666;\">=</span><span style=\"color: #bb60d5;\">$!</span>\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span>revert<span style=\"color: #666;\">()</span> <span style=\"color: #666;\">{</span>\n</span></span><span style=\"display: flex;\"><span>    <span style=\"color: #007020;\">kill</span> <span style=\"color: #bb60d5;\">$swayidle</span>\n</span></span><span style=\"display: flex;\"><span>    pactl set-sink-mute @DEFAULT_SINK@ <span style=\"color: #40a070;\">0</span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #666;\">}</span>\n</span></span><span style=\"display: flex;\"><span><span style=\"color: #007020;\">trap</span> revert SIGHUP SIGINT SIGTERM\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span>pactl set-sink-mute @DEFAULT_SINK@ <span style=\"color: #40a070;\">1</span>\n</span></span><span style=\"display: flex;\"><span>swaylock --image ~/i3lock-wallpaper-3840x2160.jpg\n</span></span><span style=\"display: flex;\"><span>revert\n</span></span></code></pre></div><h3 id=\"i3-ipc\">i3 IPC automation</h3>\n<p>The i3 window manager can be extended via its <a href=\"https://i3wm.org/docs/ipc.html\">IPC interface (interprocess\ncommunication)</a>.</p>\n<p>I use a few small tools that use this interface.</p>\n<p>I noticed the following issues when using these tools with Sway:</p>\n<ol>\n<li>\n<p>Tools using the <a href=\"https://pkg.go.dev/go.i3wm.org/i3/v4\"><code>go.i3wm.org/i3/v4</code> Go\npackage</a> need a <a href=\"https://github.com/RasmusLindroth/i3keys/blob/99e368e4cbb4f82f4e9461c3fd43054add0c3c37/i3parse/config.go#L67\">special socket path\nhook\ncurrently</a>. We\nshould probably include transparent handling in the package to ease the\ntransition.</p>\n</li>\n<li>\n<p>Tools started with <code>exec</code> from the Sway config unexpectedly keep running even\nwhen you exit Sway (<code>swaymsg exit</code>) and log into a new session!</p>\n</li>\n<li>\n<p>My\n<a href=\"https://github.com/stapelberg/workspace-populate-for-i3\">workspace-populate-for-i3</a>\ndid not work:</p>\n<ul>\n<li>Sway does not implement i3‚Äôs <a href=\"https://i3wm.org/docs/layout-saving.html\">layout\nsaving/restoring</a> because Drew\ndecided in 2017 that <a href=\"https://github.com/swaywm/sway/issues/1005#issuecomment-331526652\">the feature is ‚Äútoo complicated and hacky for too\nlittle\nbenefit‚Äù</a>. Too\nbad. I have a couple of layouts I liked that I‚Äôll need to replicate\ndifferently.</li>\n<li>Sway does not match workspace nodes with <code>[con_id]</code> criteria. There‚Äôs\n<a href=\"https://github.com/swaywm/sway/pull/8980\">pull request #8980</a> (posted\nindependently, five days ago) to fix that.</li>\n</ul>\n</li>\n<li>\n<p>My <a href=\"https://github.com/stapelberg/wsmgr-for-i3\">wsmgr-for-i3</a> worked\npartially:</p>\n<ul>\n<li>Restoring workspaces (<code>wsmgr restore</code>) worked.</li>\n<li>Sway‚Äôs <a href=\"https://i3wm.org/docs/userguide.html#_renaming_workspaces\"><code>rename workspace</code>\ncommand</a>\nimplementation does not seem to pick up workspace numbers from the target\nname.</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"foot\">Terminal: foot</h3>\n<p>On X11, I use the <a href=\"https://wiki.archlinux.org/title/Rxvt-unicode\">rxvt-unicode</a>\n(URxvt) terminal emulator. It has a couple of quality-of-life features that I\ndon‚Äôt want to lose, aside from being fast and coming with a minimal look:</p>\n<ul>\n<li>Backwards search through your scrollback (= command output)</li>\n<li>Opening URLs in your scrollback using keyboard shortcuts</li>\n<li>Opening a new terminal window in the same working directory</li>\n<li>Updating the terminal title from your shell</li>\n</ul>\n<p>In earlier experiments, I tried Alacritty or Kitty, but wasn‚Äôt happy with\neither.</p>\n<p>Thanks to <a href=\"https://anarc.at/software/desktop/wayland/#terminal-xterm-foot\">anarcat‚Äôs blog post ‚ÄúWayland: i3 to Sway\nmigration‚Äù</a>, I\ndiscovered the <a href=\"https://codeberg.org/dnkl/foot\"><code>foot</code> terminal emulator</a>, which\nlooks like a really nice option!</p>\n<p>I started a <a href=\"https://github.com/stapelberg/configfiles/commit/7cc2c08dca5dd195ce47166c57deb44e7d68909d\"><code>foot.ini</code> config\nfile</a>\nto match my URxvt config, but later I noticed that at least some colors don‚Äôt\nseem to match (some text lines with green/red background looked different). I‚Äôm\nnot sure why and have not yet looked into it any further.</p>\n<p>I noticed the following issues using <code>foot</code>:</p>\n<ul>\n<li>\n<p>Pressing Ctrl+Enter (which I seem to do by mistake quite a bit) results in\nescape sequences, whereas URxvt just treats Ctrl+Enter like Enter.</p>\n<p>This can be worked around in your shell (Zsh, in my case), see <a href=\"https://codeberg.org/dnkl/foot/issues/628\">foot issue\n#628</a> for details.</p>\n</li>\n<li>\n<p>Double-clicking on part of a URL with the mouse selects the URL (as expected),\nbut without the <code>https:</code> scheme prefix! Annoying when you do want to use the\nmouse.</p>\n<p>I can hold Ctrl to work around this, which will make <code>foot</code> select everything\nunder the pointer up to, and until, the next space characters.</p>\n</li>\n<li>\n<p>Starting <a href=\"https://manpages.debian.org/screen.1\"><code>screen(1)</code></a>\n in <code>foot</code> results in not having\ncolor support for programs running inside the <code>screen</code> session. Probably a\nterminfo-related problem somehow‚Ä¶? I can also reproduce this issue with GNOME\nterminal. But with URxvt or <a href=\"https://en.wikipedia.org/wiki/Xterm\">xterm</a>, it\nworks.</p>\n</li>\n<li>\n<p>Selecting text highlights the text within the line, but not the entire line.\nThis is different from other terminal emulators I am used to, but I don‚Äôt see\nan option to change it.</p>\n<p>Here‚Äôs a screenshot showing <code>foot</code> after triple-clicking on the right of\n‚Äúkthreadd‚Äù:</p>\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  <a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/foot-triple-long.png\"><img alt=\"triple-click in foot on a top(1) output line highlights the whole line\" height=\"188\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/foot-triple-long_hu_ac615569c350b15a.png\" style=\"border: 1px solid #000;\" title=\"triple-click in foot on a top(1) output line highlights the whole line\" width=\"600\" /></a>\n  \n  \n\n<p>But triple-clicking on an echo output line highlights only the contents, not\nthe whole line:</p>\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  <a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/foot-triple-short.png\"><img alt=\"triple-click in foot on an echo output line highlights only the contents, not the whole line\" height=\"188\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/foot-triple-short_hu_d228c42ae1be0723.png\" style=\"border: 1px solid #000;\" title=\"triple-click in foot on an echo output line highlights only the contents, not the whole line\" width=\"600\" /></a>\n  \n  \n\n</li>\n</ul>\n<h3 id=\"emacs\">Text editor: Emacs</h3>\n<p>I find Emacs‚Äôs Wayland support rather disappointing. The standard version of\nEmacs only supports X11, so on Sway, it starts in Xwayland. Because Sway does\nnot support scaling with Xwayland, Emacs shows up blurry (top/background\nwindow):</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/emacs-blurry.png\"><img alt=\"Emacs being blurry in Xwayland\" height=\"178\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/emacs-blurry_hu_1f4eb4e05ba1b280.png\" style=\"border: 1px solid #000;\" title=\"Emacs being blurry in Xwayland\" width=\"600\" /></a>\n\n\n\n<p>Native Wayland support (bottom/foreground window) is only available in the\n<code>pgtk</code> Emacs version (<code>emacs-pgtk</code> on NixOS). <code>pgtk</code> used to be a separate\nbranch, but was merged in Emacs¬†29 (July 2023). There seem to be issues\nwith <code>pgtk</code> on X11 (you get a warning when starting Emacs-pgtk on X11), so there\nhave to be two separate versions for now‚Ä¶</p>\n<p>Unfortunately, the <code>pgtk</code> text rendering looks different than native X11 text\nrendering! The line height and letter spacing seems different:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/2026-01-01-emacs-pgtk-text.png\"><img alt=\"Different text rendering in Emacs (pgtk vs. X11)\" height=\"217\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/2026-01-01-emacs-pgtk-text_hu_3f7d94e78f26ace1.png\" style=\"border: 1px solid #000;\" title=\"Different text rendering in Emacs (pgtk vs. X11)\" width=\"600\" /></a>\n\n\n\n<p>I‚Äôm not sure why it‚Äôs different! Does anybody know how to make it match the old\nbehavior?</p>\n<p>Aside from the different text rendering, the other major issue for me is input\nlatency: Emacs-pgtk feels significantly slower (less responsive) than\nEmacs. This was reported on Reddit multiple times (<a href=\"https://www.reddit.com/r/emacs/comments/1k9ihp7/emacs_sluggish_ui_with_pgtk_wayland_4k_fractional/\">thread\n1</a>,\n<a href=\"https://www.reddit.com/r/emacs/comments/1acdieh/pgtk_emacs_high_input_lag_at_large_frame_sizes_on/\">thread\n2</a>)\nand <a href=\"https://debbugs.gnu.org/cgi/bugreport.cgi?bug=71591\">Emacs bug #71591</a>, but\nthere doesn‚Äôt seem to be any solution.</p>\n<p>I‚Äôll also need a solution for running Emacs remotely. Thus far, I use X11\nforwarding over SSH (which works fine and with low latency over fiber\nconnections). I should probably check out waypipe, but have not yet had a\nchance.</p>\n<h3 id=\"chrome\">Browser: Chrome</h3>\n<p>When starting Chrome and checking the <code>chrome://gpu</code> debug page, things look\ngood:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/chrome-gpu-wayland.png\"><img alt=\"chrome://gpu on Sway\" height=\"619\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/chrome-gpu-wayland_hu_546fe7df2c265248.png\" style=\"border: 1px solid #000;\" title=\"chrome://gpu on Sway\" width=\"600\" /></a>\n\n\n\n<p>But rather quickly, after moving and resizing browser windows, the GPU process\ndies with messages like the following and, for example, WebGL is no longer\nhardware accelerated:</p>\n<pre tabindex=\"0\"><code>ERROR:ui/ozone/platform/wayland/gpu/gbm_pixmap_wayland.cc:95] Cannot create bo with format=RGBA_8888 and usage=Scanout|Rendering|Texturing\nERROR:ui/gfx/linux/gbm_wrapper.cc:405] Failed to create BO with modifiers: Invalid argument (22)\nERROR:ui/ozone/platform/wayland/gpu/gbm_pixmap_wayland.cc:95] Cannot create bo with format=RGBA_8888 and usage=Texturing\nERROR:gpu/command_buffer/service/shared_image/shared_image_factory.cc:981] CreateSharedImage: could not create backing.\nERROR:gpu/command_buffer/service/shared_image/shared_image_manager.cc:397] SharedImageManager::ProduceSkia: Trying to Produce a Skia representation from a non-existent mailbox.\nERROR:components/viz/service/gl/exit_code.cc:13] Restarting GPU process due to unrecoverable error. Context was lost.\nR:gpu/ipc/client/command_buffer_proxy_impl.cc:321] GPU state invalid after WaitForGetOffsetInRange.\nERROR:content/browser/gpu/gpu_process_host.cc:1005] GPU process exited unexpectedly: exit_code=8704\n</code></pre><p>Of course, using a browser without hardware acceleration is very frustrating,\nespecially at high resolutions. Starting Chrome with <code>--disable-gpu-compositing</code>\nseems to work around the GPU process exiting, but Chrome still does not feel as\nsmooth as on X11.</p>\n<p>Another big issue for me is that Sway does not open Chrome windows on the\nworkspace on which I closed them. Support for tracking and restoring the\n<code>_NET_WM_DESKTOP</code> EWMH atom was added to i3 in <a href=\"https://github.com/i3/i3/commit/328035fb7e98630862ae8b43088631f62b807c77\">January\n2016</a>\nand to Chrome in <a href=\"https://chromium.googlesource.com/chromium/src.git/+/06405c5944436b431f26037fdc93340842c51de5%5E%21/\">May\n2016</a>\nand Firefox in <a href=\"https://hg-edge.mozilla.org/integration/autoland/rev/323e2a212629\">March\n2020</a>.</p>\n<p>I typically have 5+ workspaces and even more Chrome windows at any given point,\nso having to sort through 10+ Chrome windows every day (when I boot my work\ncomputer) is <strong>very annoying</strong>.</p>\n<p><a href=\"https://github.com/emersion\">Simon Ser</a> said that this would be addressed with\na new Wayland protocol (<a href=\"https://gitlab.freedesktop.org/wayland/wayland-protocols/-/merge_requests/18\"><code>xdg-session-management</code>, merge request\n!18</a>).</p>\n<h3 id=\"screensharing\">Screensharing</h3>\n<p>I work remotely a lot, so screen sharing is a table-stakes feature for me.  I\nuse screen sharing in my browser almost every day, in different scenarios and\nwith different requirements.</p>\n<p>In X11, I am used to the following experience with Chrome. I click the ‚ÄúWindow‚Äù\ntab and see previews of my windows. When I select the window and confirm, its\ncontents get shared:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-x11.png\"><img alt=\"screensharing behavior in Chrome (X11)\" height=\"338\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-x11_hu_5eadab053d491b69.png\" style=\"border: 1px solid #000;\" title=\"screensharing behavior in Chrome (X11)\" width=\"600\" /></a>\n\n\n\n<p>To get screen sharing to work in Wayland/sway, you need to install\n<code>xdg-desktop-portal</code> and <code>xdg-desktop-portal-wlr</code> (the latter is specific to\nwlroots, which sway uses).</p>\n<p>With these packages set up, this is the behavior I see:</p>\n<ul>\n<li>I can share a Chrome tab.</li>\n<li>I can share the entire monitor.</li>\n<li>I <em>cannot</em> share a specific window (the entire monitor shows up as a single\nwindow).</li>\n</ul>\n<p>This is <a href=\"https://github.com/emersion/xdg-desktop-portal-wlr/issues/107\">a limitation of <code>xdg-desktop-portal-wlr</code> (and\nothers)</a>, which\nshould be addressed with the upcoming Sway 1.12 release.</p>\n<p>I changed my NixOS configuration to use sway and wlroots from git to try it\nout. When I click on the ‚ÄúWindow‚Äù tab, I see a chooser in which I need to select\na window:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-select1-featured.png\"><img alt=\"screensharing behavior in Sway\" height=\"338\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-select1-featured_hu_4b360882013550cc.png\" style=\"border: 1px solid #000;\" title=\"screensharing behavior in Sway\" width=\"600\" /></a>\n\n\n\n<p>After selecting the window, I see <em>only that window‚Äôs contents</em> previewed in\nChrome:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-select2.png\"><img alt=\"screensharing behavior in Sway\" height=\"338\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-select2_hu_a0d8fb229067ea48.png\" style=\"border: 1px solid #000;\" title=\"screensharing behavior in Sway\" width=\"600\" /></a>\n\n\n\n<p>After confirming, I get another chooser and need to select the window\nagain. Notably, there is no connection between the previewed window and the\nchosen window in this second step ‚Äî if I chose a different window, that‚Äôs what\nwill be shared:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-select3.png\"><img alt=\"screensharing behavior in Sway\" height=\"338\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/screenshare-select3_hu_de76f21970bd6130.png\" style=\"border: 1px solid #000;\" title=\"screensharing behavior in Sway\" width=\"600\" /></a>\n\n\n\n<p>Now that window is screenshared (so the feature now works; nice!), but\nunfortunately in low resolution, meaning the text is blurry for my co-workers.</p>\n<p>I reported this as <a href=\"https://github.com/emersion/xdg-desktop-portal-wlr/issues/364\">xdg-desktop-portal-wlr issue\n#364</a> and it\nseems like the issue is that the wrong scale factor is applied. The patch\nprovided in the issue works for me.</p>\n<p>But, on a high level, the whole flow seems wrong: I shouldn‚Äôt see a chooser when\nclicking on Chrome‚Äôs ‚ÄúWindow‚Äù tab. I should see previews of all windows. I\nshould be able to select the window in Chrome, not with a separate chooser.</p>\n<h3 id=\"scaling-glitches\">Scaling Glitches</h3>\n<p>I also noticed a very annoying glitch when output scaling is enabled: the\ncontents of (some!) windows would ‚Äújump around‚Äù as I was switching between\nwindows (in a tabbed or stacked container) or between workspaces.</p>\n<p>I first noticed this in the <code>foot</code> terminal emulator, where the behavior is as follows:</p>\n<ol>\n<li>Switch focus to another <code>foot</code> terminal by changing workspaces, or by\nswitching focus within a stacked or tabbed container.</li>\n<li>The new <code>foot</code> terminal shows up with its text contents slightly offset.</li>\n<li>Within a few milliseconds, <code>foot</code>‚Äôs text jumps to the correct position.</li>\n</ol>\n<p>I captured the following frame with my iPhone just as the content was moving a\nfew pixels, shortly after switching focus to this window:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/foot-move.jpg\"><img alt=\"foot content moving around\" height=\"338\" src=\"https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/foot-move_hu_ba49c2e51c18f85f.jpg\" style=\"border: 1px solid #000;\" title=\"foot content moving around\" width=\"600\" /></a>\n\n\n\n<p>Later, I also noticed that Chrome windows briefly <a href=\"https://github.com/emersion/xdg-desktop-portal-wlr/issues/364#issuecomment-3702287572\">show up blurry after\nswitching</a>.</p>\n<p>My guess is that because Sway sets the scale factor to 1 for invisible windows,\nwhen switching focus you see a scale-1 content buffer until the application\nprovided its scale-3 content buffer.</p>\n<h3 id=\"notifications-dunst\">Notifications: dunst</h3>\n<p>dunst supports Wayland natively. I tried dunst 1.13 and did not notice any\nissues.</p>\n<h3 id=\"picker-rofi\">Picker: rofi</h3>\n<p>rofi works on Wayland since v2.0.0 (2025-09-01).</p>\n<p>I use rofi with <a href=\"https://github.com/fdw/rofimoji\">rofimoji</a> as my Emoji\npicker. For text input, instead of <code>xdotool</code>, <code>wtype</code> seems to work. I didn‚Äôt\nnotice any issues.</p>\n<h3 id=\"screenshots-grim\">Screenshots: grim?</h3>\n<p>Instead of my usual choice <a href=\"https://manpages.debian.org/maim.1\"><code>maim(1)</code></a>\n, I tried <a href=\"https://manpages.debian.org/grim.1\"><code>grim(1)</code></a>\n, but unfortunately <code>grim</code>‚Äôs <code>-T</code> flag to select the\nwindow to capture is rather cumbersome to use (and captures in 1x scale).</p>\n<p>Does anyone have any suggestions for a good alternative?</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>Finally I made some progress on getting a Wayland session to work in my\nenvironment!</p>\n<p>Before giving my verdict on this Wayland/sway experiment, let me explain that my\nexperience on X11/i3 is really good. I don‚Äôt see any tearing or other artifacts\nor glitches in my day-to-day computer usage. I don‚Äôt use a compositor, so my\ninput latency is really good: I once measured it to approximately 763 Œºs in\nEmacs on X11 with my custom-built keyboard (plus output latency), see <a href=\"/posts/2018-04-17-kinx-latency-measurement/\">kinX:\nlatency measurement (2018)</a>.</p>\n<p>So from my perspective, switching from this existing, flawlessly working stack\n(for me) to Sway only brings downsides. I observe new graphical glitches that I\ndidn‚Äôt have before. The programs I spend most time in (Chrome and Emacs) run\nnoticeably worse. Because of the different implementations, or because I need to\nswitch programs entirely, I encounter a ton of new bugs.</p>\n<p>For the first time, an on-par Wayland experience seems within reach, but\nrealistically it will require weeks or even months of work still. In my\nexperience, debugging sessions quickly take hours as I need to switch graphics\ncards and rewire monitors to narrow down bugs. I don‚Äôt have the time to\ncontribute much to fixing these numerous issues unfortunately, so I‚Äôll keep\nusing X11/i3 for now.</p>\n<p>For me, a Wayland/Sway session will be ready as my daily driver when:</p>\n<ul>\n<li>Sway no longer triggers some key bindings twice some times (‚Äúghost key\npresses‚Äù)</li>\n<li>I no longer see glitches when switching between windows or workspaces in Sway.</li>\n<li>Chrome is continuously hardware-accelerated.</li>\n<li>Chrome windows are restored to their previous workspace when starting.</li>\n<li>Emacs either:\n<ul>\n<li>Runs via Xwayland and Sway makes scaling work.</li>\n<li>Or if its <code>pgtk</code> variant fixes its input latency issues\nand can be made to render text the same as before somehow.</li>\n</ul>\n</li>\n</ul>",
  "id": "https://michael.stapelberg.ch/posts/2026-01-04-wayland-sway-in-2026/"
}