{
  "title": "Development shells with Nix: four quick examples",
  "link": "https://michael.stapelberg.ch/posts/2025-07-27-dev-shells-with-nix-4-quick-examples/",
  "published": "2025-07-27T08:50:00+02:00",
  "summary": "<p>I wanted to use <a href=\"https://gocv.io/\">GoCV</a> for one of my projects (to find and\nextract paper documents from within a larger scan), without permanently having\nOpenCV on my system.</p>\n<p>This seemed like a good example use-case to demonstrate a couple of Nix commands\nI like to use, covering quick interactive one-off dev shells to fully\ndeclarative, hermetic, reproducible, shareable dev shells.</p>\n<p>Notably, you don‚Äôt need to use NixOS to run these commands! You can <a href=\"/posts/2025-06-01-nixos-installation-declarative/#setup-nix\">install and\nuse Nix</a> on any\nLinux system like Debian, Arch, etc., as long as you set a Nix path or use\nFlakes (see <a href=\"#setup\">setup</a>).</p>\n<h2 id=\"debian-way\">For comparison: The Debian Way</h2>\n<p>Before we start looking at Nix, I will show how to get GoCV running on Debian.</p>\n<p>Let‚Äôs create a minimal Go program which uses a GoCV function like\n<code>gocv.NewMat()</code>, just to verify that we can compile this program:</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-go\"><span style=\"display: flex;\"><span><span style=\"color: #007020; font-weight: bold;\">package</span><span style=\"color: #bbb;\"> </span>main<span style=\"color: #bbb;\">\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #bbb;\">\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #bbb;\"></span><span style=\"color: #007020; font-weight: bold;\">import</span><span style=\"color: #bbb;\"> </span><span style=\"color: #4070a0;\">\"gocv.io/x/gocv\"</span><span style=\"color: #bbb;\">\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #bbb;\">\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #bbb;\"></span><span style=\"color: #007020; font-weight: bold;\">func</span><span style=\"color: #bbb;\"> </span><span style=\"color: #06287e;\">main</span>()<span style=\"color: #bbb;\"> </span>{<span style=\"color: #bbb;\">\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #bbb;\">  </span>gocv.<span style=\"color: #06287e;\">NewMat</span>()<span style=\"color: #bbb;\">\n</span></span></span><span style=\"display: flex;\"><span><span style=\"color: #bbb;\"></span>}<span style=\"color: #bbb;\">\n</span></span></span></code></pre></div><p>If we try to build this on a Debian system, we get:</p>\n<pre tabindex=\"0\"><code>debian % mkdir -p /tmp/minimal\ndebian % cd /tmp/minimal\n\ndebian % cat &gt; minimal.go &lt;&lt;'EOT'\npackage main\nimport \"gocv.io/x/gocv\"\nfunc main() { gocv.NewMat(); }\nEOT\n\ndebian % go mod init minimal\ngo: creating new go.mod: module minimal\ngo: to add module requirements and sums:\n\tgo mod tidy\n\ndebian % go mod tidy\ngo: finding module for package gocv.io/x/gocv\ngo: downloading gocv.io/x/gocv v0.41.0\ngo: found gocv.io/x/gocv in gocv.io/x/gocv v0.41.0\n\ndebian % go build\n# gocv.io/x/gocv\n# [pkg-config --cflags  -- opencv4]\nPackage opencv4 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `opencv4.pc'\nto the PKG_CONFIG_PATH environment variable\nPackage 'opencv4', required by 'virtual:world', not found\n</code></pre><p>On Debian, we can install OpenCV as follows:</p>\n<pre tabindex=\"0\"><code>debian % sudo apt install libopencv-dev\n\n[‚Ä¶]\n\nSummary:\n  Upgrading: 7, Installing: 512, Removing: 0, Not Upgrading: 27\n  Download size: 367 MB\n  Space needed: 1590 MB / 281 GB available\n\nContinue? [Y/n]\n</code></pre><p>Saying ‚Äúyes‚Äù to this prompt downloads and installs over 500 packages (takes a\nfew minutes).</p>\n<p>Now the build works:</p>\n<pre tabindex=\"0\"><code>debian % go build\ndebian % file minimal\nminimal: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), [‚Ä¶]\n</code></pre><p>‚Ä¶but we have over 500 extra packages on our system that will now need to be\nupdated in all eternity, therefore I would like to separate this one-off\nexperiment from my usual system.</p>\n<p>We could use Docker to start a Debian container and work inside that container,\nbut, depending on the task, this can be cumbersome precisely because it‚Äôs a\nseparate environment. For this example, I would need to specify a volume mount\nto make my input files available to the Docker container, and I would need to\nset up environment variables before programs inside the Docker container can\nopen graphical windows on the host‚Ä¶</p>\n<p>Let‚Äôs look at how we can use Nix to help us with that!</p>\n<h2 id=\"setup\">Setup: Nix-on-Debian (or Nix-on-Arch, or‚Ä¶)</h2>\n<p>Users of NixOS can skip this section, as NixOS systems include a ready-to-use\nNix.</p>\n<p>Before you can try the examples on your own computer, you need to complete these\nthree steps:</p>\n<ol>\n<li>Install Nix</li>\n<li>Enable Flakes</li>\n<li>Set a Nix path</li>\n</ol>\n<h3 id=\"setup-install\">Step 1: Install Nix</h3>\n<p>Users of Debian, Arch, Fedora, or other Linux systems first need to install\nNix. Luckily, Nix is available for many popular Linux distributions:</p>\n<ul>\n<li>Debian ships <a href=\"https://packages.debian.org/trixie/nix-setup-systemd\">nix-setup-systemd</a></li>\n<li>Arch Linux packages <a href=\"https://archlinux.org/packages/extra/x86_64/nix/\">nix</a>\nand provides documentation <a href=\"https://wiki.archlinux.org/title/Nix\">on the Nix Arch Wiki\npage</a>. In practice, I installed the\npackage and <a href=\"/posts/2025-06-01-nixos-installation-declarative/#setup-nix\">configured a couple of <code>nixbld</code>\nusers</a>.</li>\n<li>More generally, there are Nix builds (rpm, deb, pacman) available for a number\nof distributions: <a href=\"https://github.com/nix-community/nix-installers\">https://github.com/nix-community/nix-installers</a></li>\n</ul>\n<h3 id=\"setup-flakes\">Step 2: Enable Flakes</h3>\n<p>Nix flakes are <a href=\"https://determinate.systems/posts/flake-schemas/\">‚Äúa generic way to package Nix\nartifacts‚Äù</a>.</p>\n<p>Examples 3 and 4 use Nix flakes to pin dependencies, so we need to <a href=\"/posts/2025-06-01-nixos-installation-declarative/#enabling-flakes\">enable Nix\nflakes</a>.</p>\n<h3 id=\"setup-nix-path\">Step 3: Set a Nix path</h3>\n<p>For example 1 and 2, we want to use the Nix expression <code>import &lt;nixpkgs&gt;</code>.</p>\n<p>On NixOS, this expression will follow the system version, meaning if you use\n<code>import &lt;nixpkgs&gt;</code> on a NixOS 25.05 installation, that will reference <a href=\"https://github.com/NixOS/nixpkgs/tree/nixos-25.05/\">nixpkgs\nin version nixos-25.05</a>.</p>\n<p>On other Linux systems, you‚Äôll see an error message like this:</p>\n<pre tabindex=\"0\"><code>debian-server % nix-shell -p pkg-config opencv\nerror: file 'nixpkgs' was not found in the Nix search path (add it using $NIX_PATH or -I)\n\n       at ¬´string¬ª:1:25:\n\n            1| {...}@args: with import &lt;nixpkgs&gt; args; (pkgs.runCommandCC or pkgs.runCommand) \"shell\" { buildInputs = [ (pkg-config) (opencv) ]; } \"\"\n             |                         ^\n(use '--show-trace' to show detailed location information)\n</code></pre><p>We need to tell Nix which version of <code>nixpkgs</code> to use by setting the <a href=\"https://nixos.org/guides/nix-pills/15-nix-search-paths.html\">Nix search\npath</a>:</p>\n<pre tabindex=\"0\"><code>debian-server % export NIX_PATH=nixpkgs=channel:nixos-25.05\ndebian-server % nix-shell -p pkg-config opencv\n[nix-shell:/tmp/opencv]#\n</code></pre><p>Alright! Now we are set up. Let‚Äôs jump into the first example!</p>\n<h2 id=\"nix-shell\">Example 1: Interactive one-offs: nix-shell</h2>\n<p>Nix provides a middle-ground between installing OpenCV on your system (<code>apt install</code> like in the example above) and installing OpenCV in a separate Docker\ncontainer: Nix can make available OpenCV without permanently installing it.</p>\n<p>We can run <a href=\"https://manpages.debian.org/nix-shell.1\"><code>nix-shell(1)</code></a>\n to start a bash shell in\nwhich the specified packages are available. To successfully build Go code that\nuses GoCV, we need to have OpenCV available:</p>\n<pre tabindex=\"0\"><code>% nix-shell -p pkg-config opencv\nthese 194 paths will be fetched (175.80 MiB download, 764.10 MiB unpacked):\n  /nix/store/ig2nk0hsha9xaailhaj69yv677nv95q4-abseil-cpp-20210324.2\n  /nix/store/yw5xqn8lqinrifm9ij80nrmf0i6fdcbx-alsa-lib-1.2.13\n[‚Ä¶]\n\n[nix-shell:/tmp/opencv]$ pkg-config --cflags opencv4\n-I/nix/store/mh5b1dx2ifv4jkp9a8lgssxwhzxssb96-opencv-4.11.0/include/opencv4\n</code></pre><p>In case you were wondering: Yes, we do need to specify <code>pkg-config</code> in this\n<code>nix-shell</code> command explicitly, otherwise running <code>pkg-config</code> will run the host\nversion (outside the dev shell), which cannot find <code>opencv4.pc</code>.</p>\n<h2 id=\"shell.nix\">Example 2: nix-shell config file: shell.nix</h2>\n<p>Once we have a combination of packages that work for our project (in our\nexample, just <code>pkg-config</code> and <code>opencv</code>), we can create a <code>shell.nix</code> (in any\ndirectory, but usually in the root of a project) which <code>nix-shell</code> (without the\n<code>-p</code> flag) will read:</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-nix\"><span style=\"display: flex;\"><span>{\n</span></span><span style=\"display: flex;\"><span>  pkgs <span style=\"color: #666;\">?</span> <span style=\"color: #007020; font-weight: bold;\">import</span> <span style=\"color: #235388;\">&lt;nixpkgs&gt;</span> { }<span style=\"color: #666;\">,</span>\n</span></span><span style=\"display: flex;\"><span>}:\n</span></span><span style=\"display: flex;\"><span>pkgs<span style=\"color: #666;\">.</span>mkShell {\n</span></span><span style=\"display: flex;\"><span>  packages <span style=\"color: #666;\">=</span> <span style=\"color: #007020; font-weight: bold;\">with</span> pkgs; [\n</span></span><span style=\"display: flex;\"><span>    <span style=\"color: #60a0b0; font-style: italic;\"># Explicitly list pkg-config so that mkShell will arrange</span>\n</span></span><span style=\"display: flex;\"><span>    <span style=\"color: #60a0b0; font-style: italic;\"># for the PKG_CONFIG_PATH to find the .pc files.</span>\n</span></span><span style=\"display: flex;\"><span>    pkg-config\n</span></span><span style=\"display: flex;\"><span>    opencv\n</span></span><span style=\"display: flex;\"><span>  ];\n</span></span><span style=\"display: flex;\"><span>}\n</span></span></code></pre></div><p>‚Ä¶and then, we just run <code>nix-shell</code>:</p>\n<pre tabindex=\"0\"><code>% nix-shell\n[nix-shell:/tmp/opencv]$ pkg-config --cflags opencv4\n-I/nix/store/mh5b1dx2ifv4jkp9a8lgssxwhzxssb96-opencv-4.11.0/include/opencv4\n</code></pre><p>If you‚Äôre curious, here are a couple of documentation pointers regarding the\nboilerplate around the list of packages:</p>\n<ul>\n<li>Line 1 to 3 <a href=\"https://nixos.org/guides/nix-pills/05-functions-and-imports.html\">declare a\nfunction</a>\nwith an argument set ‚Äî this is the required structure for <code>nix-shell</code> to be\nable to call your <code>shell.nix</code> file.</li>\n<li><a href=\"https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell\"><code>pkgs.mkShell</code></a> is\na convenience helper for use with <code>nix-shell</code>.</li>\n<li>The <code>with pkgs;</code> part allows us to write <code>opencv</code> instead of <code>pkgs.opencv</code>.</li>\n</ul>\n<p>By the way: With the <a href=\"https://github.com/nix-community/nixd\">nixd language\nserver</a>, editors with <a href=\"https://en.wikipedia.org/wiki/Language_Server_Protocol\">LSP\nsupport</a> can show the\nversions that packages resolve to, point out your spelling mistakes, or provide\nfeatures like ‚Äújump to definition‚Äù.</p>\n<p>For example, in this screenshot, I was editing <code>shell.nix</code> in Emacs and was\ncurious how the Nix source of the <code>opencv</code> package looked like. By pressing\n<code>M-.</code> (<code>xref-find-definitions</code>) with\n<a href=\"https://www.gnu.org/software/emacs/manual/html_node/elisp/Point.html\">‚Äúpoint‚Äù</a>\nover <code>opencv</code>, I got to <code>opencv/4.x.nix</code> in my local Nix store:</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<a href=\"https://michael.stapelberg.ch/posts/2025-07-27-dev-shells-with-nix-4-quick-examples/2025-07-19-emacs-nix-shell.jpg\"><img alt=\"Emacs showing opencv/4.x.nix after jumping to definition of opencv\" height=\"374\" src=\"https://michael.stapelberg.ch/posts/2025-07-27-dev-shells-with-nix-4-quick-examples/2025-07-19-emacs-nix-shell_hu_9fd651da07f25ae.jpg\" style=\"border: 1px solid #000;\" title=\"Emacs showing opencv/4.x.nix after jumping to definition of opencv\" width=\"600\" /></a>\n\n\n\n<h2 id=\"nix-flakes\">Example 3: Hermetic, pinned devShells: Nix Flakes</h2>\n<p>The previous examples used nixpkgs from your system (or Nix path), which means\nyou don‚Äôt need to change the <code>.nix</code> file when you upgrade your system ‚Äî\ndepending on the use-case, I see this behavior as either convenient or\nterrifying.</p>\n<p>For use-cases where it is important that the <code>.nix</code> file is built exactly the\nsame way, no matter what version the surrounding OS uses, we can use <a href=\"https://wiki.nixos.org/wiki/Flakes\">Nix\nFlakes</a> to build in a hermetic way, with\ndependency versions pinned in the <code>flake.lock</code> file.</p>\n<p>A <code>flake.nix</code> contains the same <code>mkShell</code> expression as above, but declares\nstructure around it: The <code>mkShell</code> expression goes into the\n<code>outputs.devShells.x86_64-linux.default</code> attribute and the <code>inputs</code> attribute\ncontains <a href=\"https://nix.dev/manual/nix/2.28/command-ref/new-cli/nix3-flake.html#flake-references\">Flake\nreferences</a>\nthat are available to this build:</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-nix\"><span style=\"display: flex;\"><span>{\n</span></span><span style=\"display: flex;\"><span>  inputs<span style=\"color: #666;\">.</span>nixpkgs<span style=\"color: #666;\">.</span>url <span style=\"color: #666;\">=</span> <span style=\"color: #4070a0;\">\"github:NixOS/nixpkgs/nixos-25.05\"</span>;\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span>  outputs <span style=\"color: #666;\">=</span>\n</span></span><span style=\"display: flex;\"><span>    { self<span style=\"color: #666;\">,</span> nixpkgs }:\n</span></span><span style=\"display: flex;\"><span>    {\n</span></span><span style=\"display: flex;\"><span>      devShells<span style=\"color: #666;\">.</span>x86_64-linux<span style=\"color: #666;\">.</span>default <span style=\"color: #666;\">=</span>\n</span></span><span style=\"display: flex;\"><span>        <span style=\"color: #007020; font-weight: bold;\">let</span>\n</span></span><span style=\"display: flex;\"><span>          pkgs <span style=\"color: #666;\">=</span> nixpkgs<span style=\"color: #666;\">.</span>legacyPackages<span style=\"color: #666;\">.</span>x86_64-linux;\n</span></span><span style=\"display: flex;\"><span>        <span style=\"color: #007020; font-weight: bold;\">in</span>\n</span></span><span style=\"display: flex;\"><span>        pkgs<span style=\"color: #666;\">.</span>mkShell {\n</span></span><span style=\"display: flex;\"><span>          packages <span style=\"color: #666;\">=</span> <span style=\"color: #007020; font-weight: bold;\">with</span> pkgs; [\n</span></span><span style=\"display: flex;\"><span>            <span style=\"color: #60a0b0; font-style: italic;\"># Explicitly list pkg-config so that mkShell will arrange</span>\n</span></span><span style=\"display: flex;\"><span>            <span style=\"color: #60a0b0; font-style: italic;\"># for the PKG_CONFIG_PATH to find the .pc files.</span>\n</span></span><span style=\"display: flex;\"><span>            pkg-config\n</span></span><span style=\"display: flex;\"><span>            opencv\n</span></span><span style=\"display: flex;\"><span>          ];\n</span></span><span style=\"display: flex;\"><span>        };\n</span></span><span style=\"display: flex;\"><span>    };\n</span></span><span style=\"display: flex;\"><span>}\n</span></span></code></pre></div><p>By the way: Despite the name, it is a best practice to use\n<code>nixpkgs.legacyPackages</code>, which conceptually provides a single <code>import nixpkgs</code>\nresult (<a href=\"https://discourse.nixos.org/t/using-nixpkgs-legacypackages-system-vs-import/17462/8\">for\nefficiency</a>).</p>\n<p>Now, I can use <code>nix develop</code> to get a shell with OpenCV:</p>\n<pre tabindex=\"0\"><code>% nix develop\nmichael@midna$ pkg-config --cflags opencv4\n-I/nix/store/mh5b1dx2ifv4jkp9a8lgssxwhzxssb96-opencv-4.11.0/include/opencv4\n</code></pre><p>The first <code>nix develop</code> run creates a <code>flake.lock</code> file, so running <code>nix develop</code> later will get us exactly the same environment. To update to newer\nversions, use <code>nix flake update</code>.</p>\n<p><strong>Tip:</strong> Instead of a shell, <code>nix develop --command=emacs</code> is also a useful variant.</p>\n<h2 id=\"system-indep-flake\">Example 4: Making the Flake system-independent</h2>\n<p>Unfortunately, the above <code>flake.nix</code> hard-codes <code>x86_64-linux</code>, so it will not\nbe usable on, say, an <code>aarch64-linux</code> (ARM) computer, or on a <code>x86_64-darwin</code>\n(Mac).</p>\n<p>Having to explicitly specify the <code>system</code> by default is a long-standing\ncriticism of Nix Flakes.</p>\n<p>There are a number of workarounds. For example, we can use\n<a href=\"https://github.com/numtide/flake-utils\">numtide/flake-utils</a> and refactor our\n<code>flake.nix</code> to use its\n<a href=\"https://github.com/numtide/flake-utils?tab=readme-ov-file#eachdefaultsystem--system---attrs\"><code>eachDefaultSystem</code></a>\nconvenience function:</p>\n<div class=\"highlight\"><pre tabindex=\"0\"><code class=\"language-nix\"><span style=\"display: flex;\"><span>{\n</span></span><span style=\"display: flex;\"><span>  inputs <span style=\"color: #666;\">=</span> {\n</span></span><span style=\"display: flex;\"><span>    nixpkgs<span style=\"color: #666;\">.</span>url <span style=\"color: #666;\">=</span> <span style=\"color: #4070a0;\">\"github:nixos/nixpkgs/nixos-25.05\"</span>;\n</span></span><span style=\"display: flex;\"><span>    flake-utils<span style=\"color: #666;\">.</span>url <span style=\"color: #666;\">=</span> <span style=\"color: #4070a0;\">\"github:numtide/flake-utils\"</span>;\n</span></span><span style=\"display: flex;\"><span>  };\n</span></span><span style=\"display: flex;\"><span>\n</span></span><span style=\"display: flex;\"><span>  outputs <span style=\"color: #666;\">=</span>\n</span></span><span style=\"display: flex;\"><span>    {\n</span></span><span style=\"display: flex;\"><span>      self<span style=\"color: #666;\">,</span>\n</span></span><span style=\"display: flex;\"><span>      nixpkgs<span style=\"color: #666;\">,</span>\n</span></span><span style=\"display: flex;\"><span>      flake-utils<span style=\"color: #666;\">,</span>\n</span></span><span style=\"display: flex;\"><span>    }:\n</span></span><span style=\"display: flex;\"><span>    flake-utils<span style=\"color: #666;\">.</span>lib<span style=\"color: #666;\">.</span>eachDefaultSystem (\n</span></span><span style=\"display: flex;\"><span>      system:\n</span></span><span style=\"display: flex;\"><span>      <span style=\"color: #007020; font-weight: bold;\">let</span>\n</span></span><span style=\"display: flex;\"><span>        pkgs <span style=\"color: #666;\">=</span> nixpkgs<span style=\"color: #666;\">.</span>legacyPackages<span style=\"color: #666;\">.</span><span style=\"color: #70a0d0;\">${</span>system<span style=\"color: #70a0d0;\">}</span>;\n</span></span><span style=\"display: flex;\"><span>      <span style=\"color: #007020; font-weight: bold;\">in</span>\n</span></span><span style=\"display: flex;\"><span>      {\n</span></span><span style=\"display: flex;\"><span>        formatter <span style=\"color: #666;\">=</span> pkgs<span style=\"color: #666;\">.</span>nixfmt-tree;\n</span></span><span style=\"display: flex;\"><span>        devShells<span style=\"color: #666;\">.</span>default <span style=\"color: #666;\">=</span> pkgs<span style=\"color: #666;\">.</span>mkShell {\n</span></span><span style=\"display: flex;\"><span>          packages <span style=\"color: #666;\">=</span> <span style=\"color: #007020; font-weight: bold;\">with</span> pkgs; [\n</span></span><span style=\"display: flex;\"><span>            <span style=\"color: #60a0b0; font-style: italic;\"># Explicitly list pkg-config so that mkShell will arrange</span>\n</span></span><span style=\"display: flex;\"><span>            <span style=\"color: #60a0b0; font-style: italic;\"># for the PKG_CONFIG_PATH to find the .pc files.</span>\n</span></span><span style=\"display: flex;\"><span>            pkg-config\n</span></span><span style=\"display: flex;\"><span>            opencv\n</span></span><span style=\"display: flex;\"><span>          ];\n</span></span><span style=\"display: flex;\"><span>        };\n</span></span><span style=\"display: flex;\"><span>      }\n</span></span><span style=\"display: flex;\"><span>    );\n</span></span><span style=\"display: flex;\"><span>}\n</span></span></code></pre></div><p>Or we could use <a href=\"https://github.com/numtide/blueprint\">numtide/blueprint</a>,\nits spiritual successor.</p>\n<p>LucPerkins‚Äôs dev-templates <a href=\"https://github.com/the-nix-way/dev-templates/blob/main/go/flake.nix\">have effectively\ninlined</a> a\nversion of this technique.</p>\n<p>For a solution that isn‚Äôt part of Nix, but Nix-adjacent:\n<a href=\"https://devenv.sh/\">devenv</a> is a separate tool that is built on Nix (no longer\nusing the CppNix implementation, but <a href=\"https://devenv.sh/blog/2024/10/22/devenv-is-switching-its-nix-implementation-to-tvix/\">tvix\nactually</a>),\nbut with its own .nix files.</p>\n<h2 id=\"profile-install\">Tip: Keeping packages around</h2>\n<p>If you notice that <code>nix develop</code> or similar commands fetch packages despite the\n<code>flake.lock</code> not having changed, you can install the Flake into your profile to\n<a href=\"https://nixos.org/guides/nix-pills/11-garbage-collector.html\">declare it as a gcroot to\nNix</a>:</p>\n<pre tabindex=\"0\"><code>% nix profile install .#devShells.x86_64-linux.default\n</code></pre><p>But wait, isn‚Äôt that getting us into the same state as <a href=\"#debian-way\">with The Debian\nWay</a>? No! While OpenCV will remain available indefinitely if you\ninstall the flake into your profile, there still is a layer of separation:\nWithin your system, OpenCV isn‚Äôt available, only when you start a development\nshell with <code>nix-shell</code> or <code>nix develop</code>.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>How do the four examples above compare? Here‚Äôs an overview:</p>\n<table>\n  <thead>\n      <tr>\n          <th>Example</th>\n          <th>Boilerplate</th>\n          <th>Pinned?</th>\n          <th>System-dependent?</th>\n      </tr>\n  </thead>\n  <tbody>\n      <tr>\n          <td><a href=\"#nix-shell\">Ex 1</a>: <code>nix-shell -p ‚Ä¶</code></td>\n          <td>üòä</td>\n          <td>no</td>\n          <td>no</td>\n      </tr>\n      <tr>\n          <td><a href=\"#shell.nix\">Ex 2</a>: <code>shell.nix</code></td>\n          <td>üôÇ</td>\n          <td>no</td>\n          <td>no</td>\n      </tr>\n      <tr>\n          <td><a href=\"#nix-flakes\">Ex 3</a>: <code>flake.nix</code></td>\n          <td>üò≤</td>\n          <td>yes</td>\n          <td>yes</td>\n      </tr>\n      <tr>\n          <td><a href=\"#system-indep-flake\">Ex 4</a>: system-independent <code>flake.nix</code></td>\n          <td>ü§®</td>\n          <td>yes</td>\n          <td>no</td>\n      </tr>\n  </tbody>\n</table>\n<p>For personal one-off experiments, I use <code>nix-shell</code>.</p>\n<p>Once the experiment works, I typically want to pin the dependencies, so I use a\n<code>flake.nix</code>.</p>\n<p>If this is software that isn‚Äôt just versioned, but also published (or worked on\nwith multiple people/systems), I go through the effort of making it a\nsystem-independent <code>flake.nix</code>.</p>\n<p>I hope in the future, it will become easier to write a system-independent flake.</p>\n<p>Despite the rough edges, I appreciate the reproducibility and control that Nix\ngives me!</p>",
  "id": "https://michael.stapelberg.ch/posts/2025-07-27-dev-shells-with-nix-4-quick-examples/"
}