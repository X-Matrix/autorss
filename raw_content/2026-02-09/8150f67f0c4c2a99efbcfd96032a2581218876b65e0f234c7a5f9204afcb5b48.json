{
  "title": "What Actually Is Claude Codeâ€™s Plan Mode?",
  "link": "https://lucumr.pocoo.org/2025/12/17/what-is-plan-mode/",
  "published": "2025-12-17T00:00:00+00:00",
  "summary": "<p>I&#8217;ve mentioned this a few times now, but when I started using Claude it was\nbecause <a href=\"https://x.com/steipete/\">Peter</a> got me hooked on it.  From the very\nbeginning I became a religious user of what is colloquially called YOLO mode,\nwhich basically gives the agent all the permissions so I can just watch it do\nits stuff.</p>\n<p>One consequence of YOLO mode though is that it didn&#8217;t work well together with\nthe plan mode that Claude Code had.  In the beginning it didn&#8217;t inherit all the\ntool permissions, so in plan mode it actually asked for approval all the time.\nI found this annoying and as a result I never really used plan mode.</p>\n<p>Since I haven&#8217;t been using it, I ended up with other approaches.  I&#8217;ve talked\nabout this before, but it&#8217;s a version of iterating together with the agent on\ncreating a form of handoff in the form of a markdown file.  My approach has\nbeen getting the agent to ask me clarifying questions, taking these questions\ninto an editor, answering them, and then doing a bunch of iterations until I&#8217;m\ndecently happy with the end result.</p>\n<p>That has been my approach and I thought that this was pretty popular these days.\nFor instance Mario&#8217;s <a href=\"https://shittycodingagent.ai/\">pi</a> which I also use, does\nnot have a plan mode and Amp is <a href=\"https://x.com/beyang/status/2001150592480313425\">removing\ntheirs</a>.</p>\n<p>However today I had two interesting conversations with people who really like\nplan mode.  As a non-user of plan mode, I wanted to understand how it works.  So\nI specifically looked at the Claude Code implementation to understand what it\ndoes, how it prompts the agent, and how it steers the client.  I wanted to use\nthe tool loop just to get a better understanding of what I&#8217;m missing out on.</p>\n<p>This post is basically just what I found out about how it works, and maybe it&#8217;s\nuseful to someone who also does not use plan mode and wants to know what it\nactually does.</p>\n<h2>Plan Mode in Claude Code</h2>\n<p>First we need to agree on what a plan is in Claude Code.  A plan in Claude Code\nis effectively a markdown file that is written into Claude&#8217;s plans folder by\nClaude in plan mode.  The generated plan doesn&#8217;t have any extra structure beyond\ntext.  So at least up to that point, there really is not much of a difference\nbetween you asking it to write a markdown file or it creating its own internal\nmarkdown file.</p>\n<p>There are however some other major differences.  One is that there are recurring\nprompts to remind the agent that it&#8217;s in read-only mode.  The tools for writing\nfiles through the agent&#8217;s built-in tools are actually still there.  It has a\nlittle state machine going on to enter and exit plan mode that it can use.\nInterestingly, it seems like the edit file tool is actually used to manipulate\nthe plan file.  So the agent is seemingly editing its own plan file!</p>\n<p>Because plan mode is also a tool (or at least the entering and exiting plan mode\nis), the agent can enter it itself.  This has the same effect as if you were to\npress shift+tab. <sup class=\"footnote-ref\" id=\"fnref-1\"><a href=\"#fn-1\">1</a></sup></p>\n<p>To encourage the agent to write the plan file, there is a custom prompt injected\nwhen you enter it.  There is no other enforcement from what I can tell.  Other\nagents might do this differently.</p>\n<p>When exiting plan mode it will read the plan file that it wrote to disk and then\nstart working off that.  So the path towards spec in the prompt always goes via\nthe file system.</p>\n<h2>Can You Plan Mode Without Plan Mode?</h2>\n<p>This obviously raises the question: if the differences are not that significant\nand it is just &#8220;the prompt&#8221; and some workflow around it, how much would you\nhave to write into the prompt yourself to get very similar behavior to what the\nplan mode in Claude Code does?</p>\n<p>From a user experience point of view, you basically get two things.</p>\n<ol>\n<li>You get a markdown file, but you never get to see it because it&#8217;s hidden away\nin a folder.  I would argue that putting it into a specific file has some\nbenefits because you can edit it.</li>\n<li>However there is something which you can&#8217;t really replicate and that is that\nplan mode at the end comes with a prompt to the user.  That user interface\nyou cannot bring up trivially because there is no way to bring it up without\ngoing through the exit plan mode flow, which requires the file to be in a\nspecific location.</li>\n</ol>\n<p>But if we ignore those parts and say that we just want similar behavior to what\nplan mode does from prompting alone, how much prompt do we have to write?  What\nspecifically is the delta of entering plan mode versus just writing stuff into\nthe context manually?</p>\n<h2>The Prompt Differences</h2>\n<p>When entering plan mode a bunch of stuff is thrown into the context in addition\nto the system prompt.  I don&#8217;t want to give the entire prompt here verbatim\nbecause it&#8217;s a little bit boring, but I want to break it down by roughly what it\nsends.</p>\n<p>The first thing it sends is general information that is now in plan mode which\nis read-only:</p>\n<blockquote>\n<p>Plan mode is active. The user indicated that they do not want you to execute\nyet &#8212; you MUST NOT make any edits (with the exception of the plan file\nmentioned below), run any non-readonly tools (including changing configs or\nmaking commits), or otherwise make any changes to the system.  This supercedes\nany other instructions you have received.</p>\n</blockquote>\n<p>Then there&#8217;s a little bit of stuff about how it should read and edit the plan\nmode file, but this is mostly just to ensure that it doesn&#8217;t create new plan\nfiles.  Then it sets up workflow suggestions of how plans should be structured:</p>\n<blockquote>\n<h3>Phase 1: Initial Understanding</h3>\n<p>Goal: Gain a comprehensive understanding of the user&#8217;s request by reading\nthrough code and asking them questions.</p>\n<ol>\n<li>\n<p>Focus on understanding the user&#8217;s request and the code associated with\ntheir request</p>\n</li>\n<li>\n<p>(Instructions here about parallelism for tasks)</p>\n</li>\n</ol>\n<h3>Phase 2: Design</h3>\n<p>Goal: Design an implementation approach.</p>\n<p>(Some tool instructions)</p>\n<p>In the agent prompt:</p>\n<ul>\n<li>Provide comprehensive background context from Phase 1 exploration including\nfilenames and code path traces</li>\n<li>Describe requirements and constraints</li>\n<li>Request a detailed implementation plan</li>\n</ul>\n<h3>Phase 3: Review</h3>\n<p>Goal: Review the plan(s) from Phase 2 and ensure alignment with the user&#8217;s intentions.</p>\n<ol>\n<li>Read the critical files identified by agents to deepen your understanding</li>\n<li>Ensure that the plans align with the user&#8217;s original request</li>\n<li>Use TOOL_NAME to clarify any remaining questions with the user</li>\n</ol>\n<h3>Phase 4: Final Plan</h3>\n<p>Goal: Write your final plan to the plan file (the only file you can edit).</p>\n<ul>\n<li>Include only your recommended approach, not all alternatives</li>\n<li>Ensure that the plan file is concise enough to scan quickly, but detailed\nenough to execute effectively</li>\n<li>Include the paths of critical files to be modified</li>\n</ul>\n</blockquote>\n<p>I actually thought that there would be more to the prompt than this.  In\nparticular, I was initially under the assumption that the tools actually turn\ninto read-only.  But it is just prompt reinforcement that changes the behavior\nof the tools and also which tools are available.  It is in fact just a rather\nshort predefined prompt that enters plan mode.  The tool to enter or exit plan\nmode is always available, and the same is true for edit and read files.  The\nexiting of the plan mode tool has a description that instructs the agent to\nunderstand when it&#8217;s done planning:</p>\n<blockquote>\n<p>Use this tool when you are in plan mode and have finished writing your plan to\nthe plan file and are ready for user approval.</p>\n<h3>How This Tool Works</h3>\n<ul>\n<li>You should have already written your plan to the plan file specified in the\nplan mode system message</li>\n<li>This tool does NOT take the plan content as a parameter - it will read the\nplan from the file you wrote</li>\n<li>This tool simply signals that you&#8217;re done planning and ready for the user to\nreview and approve</li>\n<li>The user will see the contents of your plan file when they review it</li>\n</ul>\n<h3>When to Use This Tool IMPORTANT: Only use this tool when the task requires</h3>\n<p>planning the implementation steps of a task that requires writing code. For\nresearch tasks where you&#8217;re gathering information, searching files, reading\nfiles or in general trying to understand the codebase - do NOT use this tool.</p>\n<h3>Handling Ambiguity in Plans Before using this tool, ensure your plan is</h3>\n<p>clear and unambiguous. If there are multiple valid approaches or unclear\nrequirements</p>\n</blockquote>\n<p>So the system prompt is the same.  It is just a little bit of extra verbiage\nwith some UX around it.  Given the length of the prompt, you can probably have\na slash-command that just copy/pastes a version of this prompt into the context\nbut you will not get the UX around it.</p>\n<p>The thing I took from this prompt is recommendations about how to use the\nsubtasks and some examples.  I&#8217;m actually not sure if that has a meaningful\nimpact on how it&#8217;s done because at least from the limited testing that I did, I\ndon&#8217;t observe much of a difference for how plan mode invokes tools versus how\nregular execution invokes tools but it&#8217;s quite possible, that this comes down to\nmy prompting styles.</p>\n<h2>Why Does It Matter?</h2>\n<p>So you might ask why I even write about plan mode.  The main motivation is that\nI am always quite interested in where the user experience in an agentic tool has\nto be enforced by the harness versus when that user experience comes naturally\nfrom the model.</p>\n<p>Plan mode as it exists in Claude has this sort of weirdness in my mind where it\ndoesn&#8217;t come quite natural to me.  It might come natural to others!  But why can\nI not just ask the model to plan with me?  Why do I have to switch the user\ninterface into a different mode?  Plan mode is just one of many examples where I\nthink that because we are already so used to writing or talking to machines,\nbringing in more complexity in the user interface takes away some of the magic.\nI always want to look into whether just working with the model can accomplish\nsomething similar enough that I don&#8217;t actually need to have another user\ninteraction or a user interface that replicates something that natural language\ncould potentially do.</p>\n<p>This is particularly true because my workflow involves wanting to double check\nwhat these plans are, to edit them, and to manipulate them.  I feel like I&#8217;m\nmore in control of that experience if I have a file on disk somewhere that I\ncan see, that I can read, that I can review, that I can edit before actually\nacting on it.  The Claude integrated user experience is just a little bit too\nfar away from me to feel natural.  I understand that other people might have\ndifferent opinions on this, but for me that experience really was triggered by\nthe thought that if people have such a great experience with plan mode, I want\nto understand what I&#8217;m missing out on.</p>\n<p>And now I know: I&#8217;m mostly a custom prompt to give it structure, and some system\nreminders and a handful of examples.</p>\n<div class=\"footnotes\">\n<ol>\n<li id=\"fn-1\">\n<p>This incidentally is also why it&#8217;s possible for the plan mode\nconfirmation screen to come up with an error message, that <a href=\"https://x.com/mitsuhiko/status/1997983563891818736\">there is no\nplan</a> unprompted.<a class=\"footnote\" href=\"#fnref-1\">&#8617;</a></p></li>\n</ol>\n</div>",
  "id": "https://lucumr.pocoo.org/2025/12/17/what-is-plan-mode/"
}