{
  "title": "Adding dynamic features to an aggressively cached website",
  "link": "https://simonwillison.net/2026/Jan/28/dynamic-features-static-site/#atom-everything",
  "published": "2026-01-28T22:10:08+00:00",
  "summary": "<p>My blog uses aggressive caching: it sits behind Cloudflare with a 15 minute cache header, which guarantees it can survive even the largest traffic spike to any given page. I've recently added a couple of dynamic features that work in spite of that full-page caching. Here's how those work.</p>\n<h4 id=\"edit-links-that-are-visible-only-to-me\">Edit links that are visible only to me</h4>\n<p>This is a Django site and I manage it through the Django admin.</p>\n<p>I have <a href=\"https://github.com/simonw/simonwillisonblog/blob/b8066f870a94d149f5e8cee6e787d3377c0b9507/blog/models.py#L254-L449\">four types of content</a> - entries, link posts (aka blogmarks), quotations and notes. Each of those has a different model and hence a different Django admin area.</p>\n<p>I wanted an \"edit\" link on the public pages that was only visible to me.</p>\n<p>The button looks like this:</p>\n<p><img alt=\"Entry footer - it says Posted 27th January 2026 at 9:44 p.m. followed by a square Edit button with an icon.\" src=\"https://static.simonwillison.net/static/2026/edit-link.jpg\" /></p>\n<p>I solved conditional display of this button with <code>localStorage</code>. I have a <a href=\"https://github.com/simonw/simonwillisonblog/blob/b8066f870a94d149f5e8cee6e787d3377c0b9507/templates/base.html#L89-L105\">tiny bit of JavaScript</a> which checks to see if the <code>localStorage</code> key <code>ADMIN</code> is set and, if it is, displays an edit link based on a data attribute:</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-smi\">document</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">addEventListener</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'DOMContentLoaded'</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">(</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-smi\">window</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">localStorage</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">getItem</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'ADMIN'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-smi\">document</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">querySelectorAll</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'.edit-page-link'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">forEach</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">el</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">{</span>\n      <span class=\"pl-k\">const</span> <span class=\"pl-s1\">url</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">el</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">getAttribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'data-admin-url'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">url</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n        <span class=\"pl-k\">const</span> <span class=\"pl-s1\">a</span> <span class=\"pl-c1\">=</span> <span class=\"pl-smi\">document</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">createElement</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'a'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-s1\">a</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">href</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">url</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-s1\">a</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">className</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'edit-link'</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-s1\">a</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">innerHTML</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'&lt;svg&gt;...&lt;/svg&gt; Edit'</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-s1\">el</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">appendChild</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">a</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n        <span class=\"pl-s1\">el</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">style</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">display</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'block'</span><span class=\"pl-kos\">;</span>\n      <span class=\"pl-kos\">}</span>\n    <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span></pre></div>\n<p>If you want to see my edit links you can run this snippet of JavaScript:</p>\n<div class=\"highlight highlight-source-js\"><pre><span class=\"pl-s1\">localStorage</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">setItem</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'ADMIN'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'1'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span></pre></div>\n<p>My Django admin dashboard has <a href=\"https://github.com/simonw/simonwillisonblog/blob/b8066f870a94d149f5e8cee6e787d3377c0b9507/templates/admin/index.html#L18-L39\">a custom checkbox</a> I can click to turn this option on and off in my own browser:</p>\n<p><img alt=\"Screenshot of a Tools settings panel with a teal header reading &quot;Tools&quot; followed by three linked options: &quot;Bulk Tag Tool - Add tags to multiple items at once&quot;, &quot;Merge Tags - Merge multiple tags into one&quot;, &quot;SQL Dashboard - Run SQL queries against the database&quot;, and a checked checkbox labeled &quot;Show &quot;Edit&quot; links on public pages&quot;\" src=\"https://static.simonwillison.net/static/2026/edit-toggle.jpg\" /></p>\n<h4 id=\"random-navigation-within-a-tag\">Random navigation within a tag</h4>\n<p>Those admin edit links are a very simple pattern. A more interesting one is a feature I added recently for navigating randomly within a tag.</p>\n<p>Here's an animated GIF showing those random tag navigations in action (<a href=\"https://simonwillison.net/tag/ai-ethics/\">try it here</a>):</p>\n<p><img alt=\"Animated demo. Starts on the ai-ethics tag page where a new Random button sits next to the feed icon. Clicking that button jumps to a post with that tag and moves the button into the site header - clicking it multiple times jumps to more random items.\" src=\"https://static.simonwillison.net/static/2026/random-by-tag.gif\" /></p>\n<p>On any of my blog's tag pages you can click the \"Random\" button to bounce to a random post with that tag. That random button then persists in the header of the page and you can click it to continue bouncing to random items in that same tag.</p>\n<p>A post can have multiple tags, so there needs to be a little bit of persistent magic to remember which tag you are navigating and display the relevant button in the header.</p>\n<p>Once again, this uses <code>localStorage</code>. Any click to a random button records both the tag and the current timestamp to the <code>random_tag</code> key in <code>localStorage</code> before redirecting the user to the <code>/random/name-of-tag/</code> page, which selects a random post and redirects them there.</p>\n<p>Any time a new page loads, JavaScript checks if that <code>random_tag</code> key has a value that was recorded within the past 5 seconds. If so, that random button is appended to the header.</p>\n<p>This means that, provided the page loads within 5 seconds of the user clicking the button, the random tag navigation will persist on the page.</p>\n<p>You can <a href=\"https://github.com/simonw/simonwillisonblog/blob/b8066f870a94d149f5e8cee6e787d3377c0b9507/templates/base.html#L106-L147\">see the code for that here</a>.</p>\n<h4 id=\"and-the-prompts\">And the prompts</h4>\n<p>I built the random tag feature entirely using Claude Code for web, prompted from my iPhone. I started with the <code>/random/TAG/</code> endpoint (<a href=\"https://gistpreview.github.io/?2e7de58a779271aa5eb6f4abcd412d72/index.html\">full transcript</a>):</p>\n<blockquote>\n<p>Build /random/TAG/ - a page which picks a random post (could be an entry or blogmark or note or quote) that has that tag and sends a 302 redirect to it, marked as no-cache so Cloudflare does not cache it</p>\n<p>Use a union to build a list of every content type (a string representing the table out of the four types) and primary key for every item tagged with that tag, then order by random and return the first one</p>\n<p>Then inflate the type and ID into an object and load it and redirect to the URL</p>\n<p>Include tests - it should work by setting up a tag with one of each of the content types and then running in a loop calling that endpoint until it has either returned one of each of the four types or it hits 1000 loops at which point fail with an error</p>\n</blockquote>\n<p>Then:</p>\n<blockquote>\n<p>I do not like that solution, some of my tags have thousands of items</p>\n<p>Can we do something clever with a CTE?</p>\n</blockquote>\n<p>Here's the <a href=\"https://github.com/simonw/simonwillisonblog/blob/b8066f870a94d149f5e8cee6e787d3377c0b9507/blog/views.py#L737-L762\">something clever with a CTE</a> solution we ended up with.</p>\n<p>For the \"Random post\" button (<a href=\"https://gistpreview.github.io/?d2d3abe380080ceb9e7fb854fa197bff/index.html\">transcript</a>):</p>\n<blockquote>\n<p>Look at most recent commit, then modify the /tags/xxx/ page to have a \"Random post\" button which looks good and links to the /random/xxx/ page</p>\n</blockquote>\n<p>Then:</p>\n<blockquote>\n<p>Put it before not after the feed icon. It should only display if a tag has more than 5 posts</p>\n</blockquote>\n<p>And finally, the <code>localStorage</code> implementation that persists a random tag button in the header (<a href=\"https://gistpreview.github.io/?8405b84f8e53738c8d4377b2e41dcdef/page-001.html\">transcript</a>):</p>\n<blockquote>\n<p>Review the last two commits. Make it so clicking the Random button on a tag page sets a localStorage value for random_tag with that tag and a timestamp. On any other page view that uses the base item template add JS that checks for that localStorage value and makes sure the timestamp is within 5 seconds. If it is within 5 seconds it adds a \"Random name-of-tag\" button to the little top navigation bar, styled like the original Random button, which bumps the localStorage timestamp and then sends the user to /random/name-of-tag/ when they click it. In this way clicking \"Random\" on a tag page will send the user into an experience where they can keep clicking to keep surfing randomly in that topic.</p>\n</blockquote>\n    \n        <p>Tags: <a href=\"https://simonwillison.net/tags/caching\">caching</a>, <a href=\"https://simonwillison.net/tags/django\">django</a>, <a href=\"https://simonwillison.net/tags/javascript\">javascript</a>, <a href=\"https://simonwillison.net/tags/localstorage\">localstorage</a>, <a href=\"https://simonwillison.net/tags/ai\">ai</a>, <a href=\"https://simonwillison.net/tags/cloudflare\">cloudflare</a>, <a href=\"https://simonwillison.net/tags/generative-ai\">generative-ai</a>, <a href=\"https://simonwillison.net/tags/llms\">llms</a>, <a href=\"https://simonwillison.net/tags/ai-assisted-programming\">ai-assisted-programming</a></p>",
  "id": "https://simonwillison.net/2026/Jan/28/dynamic-features-static-site/#atom-everything"
}