{
  "title": "Notes on the Pentium's microcode circuitry",
  "link": "http://www.righto.com/2025/03/pentium-microcde-rom-circuitry.html",
  "published": "2025-03-31T10:14:00.000-07:00",
  "summary": "<p>Most people think of machine instructions as the fundamental steps that a computer performs.\nHowever, many processors have another layer of software underneath: microcode.\nWith microcode, instead of building the processor's control circuitry from complex logic gates, the control logic is\nimplemented with code known as microcode, stored in the microcode ROM.\nTo execute a machine instruction, the computer internally executes several simpler micro-instructions, specified by the microcode.\nIn this post, I examine the microcode ROM in the original Pentium, looking at the low-level circuitry.</p>\n<p>The photo below shows the Pentium's thumbnail-sized silicon die under a microscope.\nI've labeled the main functional blocks.\nThe microcode ROM is highlighted at the right.\nIf you look closely, you can see that the microcode ROM consists of two rectangular banks, one above the other.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/pentium-labeled.jpg\"><img alt=\"This die photo of the Pentium shows the location of the microcode ROM. Click this image (or any other) for a larger version.\" class=\"hilite\" height=\"524\" src=\"https://static.righto.com/images/pentium-microcode1/pentium-labeled-w500.jpg\" title=\"This die photo of the Pentium shows the location of the microcode ROM. Click this image (or any other) for a larger version.\" width=\"500\" /></a><div class=\"cite\">This die photo of the Pentium shows the location of the microcode ROM. Click this image (or any other) for a larger version.</div></p>\n<p>The image below shows a closeup of the two microcode ROM banks.\nEach bank provides 45 bits of output; together they implement a micro-instruction that is 90 bits long.\nEach bank consists of a grid of transistors arranged into 288 rows and 720 columns.\nThe microcode ROM holds 4608 micro-instructions,\n414,720 bits in total.\nAt this magnification, the ROM appears featureless, but it is covered with horizontal wires, each just 1.5 µm\nthick.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/rom-output-lines.jpg\"><img alt=\"The 90 output lines from the ROM, with a closeup of six lines exiting the ROM.\" class=\"hilite\" height=\"470\" src=\"https://static.righto.com/images/pentium-microcode1/rom-output-lines-w500.jpg\" title=\"The 90 output lines from the ROM, with a closeup of six lines exiting the ROM.\" width=\"500\" /></a><div class=\"cite\">The 90 output lines from the ROM, with a closeup of six lines exiting the ROM.</div></p>\n<p>The ROM's 90 output lines are collected into a bundle of wires between the banks, as shown above.\nThe detail shows how six of the bits exit from the banks and join the bundle.\nThis bundle exits the ROM to the left, travels to various parts of the chip, and controls the chip's circuitry.\nThe output lines are in the chip's top metal layer (M3):\nthe Pentium has three layers of metal wiring with M1 on the bottom, M2 in the middle, and M3 on top.</p>\n<p>The Pentium has a large number of bits in its micro-instruction, 90 bits compared to 21 bits in the <a href=\"https://www.righto.com/2022/11/how-8086-processors-microcode-engine.html\">8086</a>.\nPresumably, the Pentium has a \"horizontal\" microcode architecture, where the microcode bits correspond to low-level control signals,\nas opposed to \"vertical\" microcode, where the bits are encoded into denser micro-instructions.\nI don't have any information on the Pentium's encoding of microcode; unlike the 8086, the Pentium's patents don't provide any clues.\nThe 8086's microcode ROM holds 512 micro-instructions, much less than the Pentium's 4608 micro-instructions.\nThis makes sense, given the much greater complexity of the Pentium's instruction set, including the floating-point unit on the chip.</p>\n<!-- 40.8 pixels (blue) for metal lines + gap. 15625 pixels/mm. 2.6 µm total so 1.3 µm for metal line alone. -->\n\n<p>The image below shows a closeup of the Pentium's microcode ROM.\nFor this image, I removed the three layers of metal and the polysilicon layer\nto expose the chip's underlying silicon.\nThe pattern of silicon doping is visible, showing the transistors and thus the data stored in the ROM.\nIf you have enough time, you can extract the bits from the ROM by examining the silicon and seeing where transistors are present.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/rom-closeup.jpg\"><img alt=\"A closeup of the ROM showing how bits are encoded in the layout of transistors.\" class=\"hilite\" height=\"469\" src=\"https://static.righto.com/images/pentium-microcode1/rom-closeup-w500.jpg\" title=\"A closeup of the ROM showing how bits are encoded in the layout of transistors.\" width=\"500\" /></a><div class=\"cite\">A closeup of the ROM showing how bits are encoded in the layout of transistors.</div></p>\n<p>Before explaining the ROM's circuitry, I'll review how an NMOS transistor is constructed.\nA transistor can be considered a switch between the source and drain, controlled by the gate.\nThe source and drain regions (green) consist of silicon doped with impurities to change its semiconductor properties, forming N+ silicon.\n(These regions are visible in the photo above.)\nThe gate consists of a layer of polysilicon (red), separated from the silicon by a very thin insulating oxide layer. Whenever polysilicon crosses active silicon, a transistor is formed. </p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/mosfet-n.jpg\"><img alt=\"Diagram showing the structure of an NMOS transistor.\" class=\"hilite\" height=\"231\" src=\"https://static.righto.com/images/pentium-microcode1/mosfet-n-w400.jpg\" title=\"Diagram showing the structure of an NMOS transistor.\" width=\"400\" /></a><div class=\"cite\">Diagram showing the structure of an NMOS transistor.</div></p>\n<p>Bits are stored in the ROM through the pattern of transistors in the grid.\nThe presence or absence of a transistor stores a 0 or 1 bit.<span id=\"fnref:ambiguity\"><a class=\"ref\" href=\"#fn:ambiguity\">1</a></span>\nThe closeup below shows eight bits of the microcode ROM. There are four transistors present and four gaps where transistors are\nmissing.\nThus, this part of the ROM holds four 0 bits and four 1 bits.\nFor the diagram below, I removed the three metal layers and the polysilicon to show the underlying silicon.\nI colored doped (active) silicon regions green, and drew in the horizontal polysilicon lines in red.\nAs explained above, a transistor is created if polysilicon crosses doped silicon.\nThus, the contents of the ROM are defined by the pattern of silicon regions, which creates the transistors.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/rom-transistors.jpg\"><img alt=\"Eight bits of the microcode ROM, with four transistors present.\" class=\"hilite\" height=\"211\" src=\"https://static.righto.com/images/pentium-microcode1/rom-transistors-w500.jpg\" title=\"Eight bits of the microcode ROM, with four transistors present.\" width=\"500\" /></a><div class=\"cite\">Eight bits of the microcode ROM, with four transistors present.</div></p>\n<p>The horizontal silicon lines are used as wiring to provide ground to the transistors, while the horizontal polysilicon lines select one of the\nrows in the ROM.\nThe transistors in that row will turn on, pulling the associated output lines low.\nThat is, the presence of a transistor in a row causes the output to be pulled low, while the absence of a transistor causes\nthe output line to remain high.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/rom-schematic.jpg\"><img alt=\"A schematic corresponding to the eight bits above.\" class=\"hilite\" height=\"225\" src=\"https://static.righto.com/images/pentium-microcode1/rom-schematic-w300.jpg\" title=\"A schematic corresponding to the eight bits above.\" width=\"300\" /></a><div class=\"cite\">A schematic corresponding to the eight bits above.</div></p>\n<p>The diagram below shows the silicon, polysilicon, and bottom metal (M1) layers. I removed the metal from the left to reveal the silicon and polysilicon underneath, but the pattern of vertical metal lines continues there.\nAs shown earlier, the silicon pattern forms transistors. Each horizontal metal line has a connection\nto ground through a metal line (not shown).\nThe horizontal polysilicon lines select a row.\nWhen polysilicon lines cross doped silicon, the gate of a transistor is formed.\nTwo transistors may share the drain, as in the transistor pair on the left.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/m1-diagram.jpg\"><img alt=\"Diagram showing the silicon, polysilicon, and M1 layers.\" class=\"hilite\" height=\"330\" src=\"https://static.righto.com/images/pentium-microcode1/m1-diagram-w500.jpg\" title=\"Diagram showing the silicon, polysilicon, and M1 layers.\" width=\"500\" /></a><div class=\"cite\">Diagram showing the silicon, polysilicon, and M1 layers.</div></p>\n<p>The vertical metal wires form the outputs. The circles are contacts between the metal wire and the silicon of a transistor.<span id=\"fnref:contacts\"><a class=\"ref\" href=\"#fn:contacts\">2</a></span>\nShort metal jumpers connect the polysilicon lines to the metal layer above, which will be described next.</p>\n<p>The image below shows the upper left corner of the ROM. The yellowish metal lines are the top metal layer (M3), while the\nreddish metal lines are the middle metal layer (M2).\nThe thick yellowish M3 lines distribute ground to the ROM. Underneath the horizontal M3 line, a horizontal M2 line also\ndistributes ground.\nThe grids of black dots are numerous contacts between the M3 line and the M2 line, providing a low-resistance connection.\nThe M2 line, in turn, connects to vertical M1 ground lines underneath&mdash;these wide vertical lines are faintly visible.\nThese M1 lines connect to the silicon, as shown earlier, providing ground to each transistor.\nThis illustrates the complexity of power distribution in the Pentium: the thick top metal (M3) is the primary distribution of\n+5 volts and ground through the chip, but power must be passed down through M2 and M1 to reach the transistors.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/rom-m3.jpg\"><img alt=\"The upper left corner of the ROM.\" class=\"hilite\" height=\"419\" src=\"https://static.righto.com/images/pentium-microcode1/rom-m3-w600.jpg\" title=\"The upper left corner of the ROM.\" width=\"600\" /></a><div class=\"cite\">The upper left corner of the ROM.</div></p>\n<p>The other important feature above is the horizontal metal lines, which help distribute the row-select signals.\nAs shown earlier, horizontal polysilicon lines provide the row-select signals to the transistors.\nHowever, polysilicon is not as good a conductor as metal, so long polysilicon lines have too much resistance.\nThe solution is to run metal lines in parallel, periodically connected to the underlying polysilicon lines and\nreducing the overall resistance.\nSince the vertical metal output lines are in the M1 layer, the horizontal row-select lines run in the M2 layer so they don't collide.\nShort \"jumpers\" in the M1 layer connect the M2 lines to the polysilicon lines.</p>\n<p>To summarize, each ROM bank contains a grid of transistors and transistor vacancies to define the bits of the ROM.\nThe ROM is carefully designed so the different layers&mdash;silicon, polysilicon, M1, and M2&mdash;work together to maximize the\nROM's performance and density.</p>\n<h2>Microcode Address Register</h2>\n<p>As the Pentium executes an instruction, it provides the address of each micro-instruction to the microcode ROM.\nThe Pentium holds this address&mdash;the micro-address&mdash;in the Microcode Address Register (MAR).\nThe MAR is a 13-bit register located above the microcode ROM. </p>\n<p>The diagram below shows the Microcode Address Register above the upper ROM bank.\nIt consists of 13 bits; each bit has multiple latches to hold the value as well as any pushed subroutine micro-addresses.\nBetween bits 7 and 8, some buffer circuitry amplifies the control signals that go to each bit's circuitry.\nAt the right, drivers amplify the outputs from the MAR, sending the signals to the row drivers and column-select circuitry that\nI will discuss below.\nTo the left of the MAR is a 32-bit register that is apparently unrelated to the microcode ROM, although I haven't determined its function.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/MAR.jpg\"><img alt=\"The Microcode Address Register is located above the upper ROM bank.\" class=\"hilite\" height=\"226\" src=\"https://static.righto.com/images/pentium-microcode1/MAR-w600.jpg\" title=\"The Microcode Address Register is located above the upper ROM bank.\" width=\"600\" /></a><div class=\"cite\">The Microcode Address Register is located above the upper ROM bank.</div></p>\n<p>The outputs from the Microcode Address Register select rows and columns in the microcode ROM, as I'll explain\nbelow.\nBits 12 through 7 of the MAR select a block of 8 rows, while bits 6 through 4 select a row in this block.\nBits 3 through 0 select one column out of each group of 16 columns to select an output bit.\nThus, the microcode address controls what word is provided by the ROM.</p>\n<p>Several different operations can be performed on the Microcode Address Register.\nWhen executing a machine instruction, the MAR must be loaded with the address of the corresponding\nmicrocode routine.\n(I haven't determined how this address is generated.)\nAs microcode is executed, the MAR is usually incremented to move to the next micro-instruction.\nHowever, the MAR can branch to a new micro-address as required.\nThe MAR also supports microcode subroutine calls; it will push the current micro-address and jump to the new micro-address.\nAt the end of the micro-subroutine, the micro-address is popped so execution returns to the previous location.\nThe MAR supports three levels of subroutine calls, as it contains three registers to hold the stack of pushed micro-addresses.</p>\n<p>The MAR receives control signals and addresses from <a href=\"https://www.righto.com/2024/07/pentium-standard-cells.html\">standard-cell logic</a>\nlocated above the MAR.\nStrangely, in Intel's published <a href=\"https://doi.org/10.1109/40.216745\">floorplans</a> for the Pentium, this standard-cell logic is\nlabeled as part of the branch prediction logic, which is above it.\nHowever, carefully tracing the signals from the standard-cell logic shows that is connected to the Microcode Address Register, not\nthe branch predictor.</p>\n<h2>Row-select drivers</h2>\n<p>As explained above, each ROM bank has 288 rows of transistors, with polysilicon lines to select one of the rows.\nTo the right of the ROM is circuitry that activates one of these row-select lines, based on the micro-address.\nEach row matches a different 9-bit address. A straightforward implementation would use a 9-input AND gate for each\nrow, matching a particular pattern of 9 address bits or their complements.</p>\n<p>However, this implementation would require 576 very large AND gates, so it is impractical.\nInstead, the Pentium uses an optimized implementation with one 6-input AND gate for each group of 8 rows.\nThe remaining three address bits are decoded once at the top of the ROM.\nAs a result, each row only needs one gate, detecting if its group of eight rows is selected and if the particular one of eight\nis selected.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/row-driver-schematic.jpg\"><img alt=\"Simplified schematic of the row driver circuitry.\" class=\"hilite\" height=\"453\" src=\"https://static.righto.com/images/pentium-microcode1/row-driver-schematic-w500.jpg\" title=\"Simplified schematic of the row driver circuitry.\" width=\"500\" /></a><div class=\"cite\">Simplified schematic of the row driver circuitry.</div></p>\n<p>The schematic above shows the circuitry for a group of eight rows, slightly simplified.<span id=\"fnref:simplified-rows\"><a class=\"ref\" href=\"#fn:simplified-rows\">3</a></span>\nAt the top, three address bits are decoded, generating eight output lines with one active at a time.\nThe remaining six address bits are inverted, providing the bit and its complement to the decoding circuitry.\nThus, the 9 bits are converted into 20 signals that flow through the decoders, a large number of wires, but not unmanageable.\nEach group of eight rows has a 6-input AND gate that matches a particular 6-bit address, determined by which inputs are\ncomplemented and which are not.<span id=\"fnref:binary\"><a class=\"ref\" href=\"#fn:binary\">4</a></span>\nThe NAND gate and inverter at the left combine the 3-bit decoding and the 6-bit decoding, activating the appropriate row.</p>\n<p>Since there are up to 720 transistors in each row, the row-select lines need to be driven with high current.\nThus, the row-select drivers use large transistors, roughly 25 times the size of a regular transistor.\nTo fit these transistors into the same vertical spacing as the rest of the decoding circuitry, a tricky packing is used.\nThe drivers for each group of 8 rows are packed into a 3&times;3 grid, except the first column has two drivers (since there\nare 8 drivers in the group, not 9).\nTo avoid a gap, the drivers in the first column are larger vertically and squashed horizontally.</p>\n<h2>Output circuitry</h2>\n<p>The schematic below shows the multiplexer circuit that selects one of 16 columns for a microcode output bit.\nThe first stage has four 4-to-1 multiplexers. Next, another 4-to-1 multiplexer selects one of the outputs.\nFinally, a BiCMOS driver amplifies the output for transmission to the rest of the processor.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/output-mux.jpg\"><img alt=\"The 16-to-1 multiplexer/output driver.\" class=\"hilite\" height=\"272\" src=\"https://static.righto.com/images/pentium-microcode1/output-mux-w700.jpg\" title=\"The 16-to-1 multiplexer/output driver.\" width=\"700\" /></a><div class=\"cite\">The 16-to-1 multiplexer/output driver.</div></p>\n<p>In more detail, the ROM and the first multiplexer are essentially NMOS circuits, rather than CMOS. Specifically, the ROM's\ngrid of transistors is constructed from NMOS transistors that can pull a column line low, but there are no PMOS transistors in\nthe grid to pull the line high (since that would double the size of the ROM).\nInstead, the multiplexer includes precharge transistors to pull the lines high, presumably in the clock phase before the\nROM is read.\nThe capacitance of the lines will keep the line high unless it is pulled low by a transistor in the grid.\nOne of the four transistors in the multiplexer is activated (by control signal <code>a</code>, <code>b</code>, <code>c</code>, or <code>d</code>) to select the desired line.\nThe output goes to a \"keeper\" circuit, which keeps the output high unless it is pulled low.\nThe keeper uses an inverter with a weak PMOS transistor that can only provide a small pull-up current.\nA stronger low input will overpower this transistor, switching the state of the keeper. </p>\n<p>The output of this multiplexer, along with the outputs of three other multiplexers, goes to the second-stage multiplexer,<span id=\"fnref:mux\"><a class=\"ref\" href=\"#fn:mux\">5</a></span>\nwhich selects one of its four inputs, based on control signals <code>e</code>, <code>f</code>, <code>g</code>, and <code>h</code>.\nThe output of this multiplexer is held in a latch built from two inverters. The second latch has weak transistors so the latch\ncan be easily forced into the desired state.\nThe output from the first latch goes through a CMOS switch into a second latch, creating a flip-flop.</p>\n<p>The output from the second latch goes to a BiCMOS driver, which drives one of the 90 microcode output lines.\nMost processors are built from CMOS circuitry (i.e. NMOS and PMOS transistors), but the Pentium is built from BiCMOS circuitry:\nbipolar transistors as well as CMOS.\nAt the time, bipolar transistors improved performance for high-current drivers; see my\narticle on\n<a href=\"https://www.righto.com/2025/01/pentium-reverse-engineering-bicmos.html\">the Pentium's BiCMOS circuitry</a>.</p>\n<p>The diagram below shows three bits of the microcode output. This circuitry is for the upper ROM bank; the circuitry is\nmirrored for the lower bank.\nThe circuitry matches the schematic above. Each of the three blocks has 16 input lines from the ROM grid.\nFour 4-to-1 multiplexers reduce this to 4 lines, and the second multiplexer selects a single line. The result is latched\nand amplified by the output driver.\n(Note the large square shape of the bipolar transistors.)\nNext is the shift register that processes the microcode ROM outputs for testing.\nThe shift register uses XOR logic for its feedback; unlike the rest of the circuitry, the XOR logic is irregular since\nonly some bits are fed into XOR gates.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/output-die.jpg\"><img alt=\"Three bits of output from the microcode, I removed the three metal layers to show the polysilicon and silicon.\" class=\"hilite\" height=\"523\" src=\"https://static.righto.com/images/pentium-microcode1/output-die-w500.jpg\" title=\"Three bits of output from the microcode, I removed the three metal layers to show the polysilicon and silicon.\" width=\"500\" /></a><div class=\"cite\">Three bits of output from the microcode, I removed the three metal layers to show the polysilicon and silicon.</div></p>\n<h3>Circuitry for testing</h3>\n<p>Why does the microcode ROM have shift registers and XOR gates?\nThe reason is that a chip such as the Pentium is very difficult to test: if one out of 3.1 million transistors goes bad, how do you detect it? For a simple processor like the 8086, you can run through the instruction set and be fairly confident that any problem would turn up.\nBut with a complex chip, it is almost impossible to design an instruction sequence that would test every bit of the microcode ROM, every bit of the cache, and so forth.\nStarting with the 386, Intel added circuitry to the processor solely to make testing easier; about 2.7% of the transistors in the 386 were for testing.</p>\n<p>The Pentium has this testing circuitry for many ROMs and PLAs, including the division PLA that caused the infamous <a href=\"https://www.righto.com/2024/12/this-die-photo-of-pentium-shows.html\">FDIV bug</a>.\nTo test a ROM inside the processor, Intel added circuitry to scan the entire ROM and checksum its contents.\nSpecifically, a pseudo-random number generator runs through each address, while another circuit computes a checksum of the ROM output, forming a \"signature\" word.\nAt the end, if the signature word has the right value, the ROM is almost certainly correct.\nBut if there is even a single bit error, the checksum will be wrong and the chip will be rejected.</p>\n<p>The pseudo-random numbers and the checksum are both implemented with linear feedback shift registers (LFSR), a shift register along with a few XOR gates to feed the output back to the input.\nFor more information on testing circuitry in the 386, see <a href=\"https://doi.org/10.1109/MDT.1987.295165\">Design and Test of the 80386</a>, written by Pat Gelsinger, who became Intel's CEO years later.</p>\n<h2>Conclusions</h2>\n<p>You'd think that implementing a ROM would be straightforward, but the Pentium's microcode ROM is surprisingly complex due to\nits optimized structure and its circuitry for testing.\nI haven't been able to determine much about how the microcode works, except that the micro-instruction is 90 bits wide and\nthe ROM holds 4608 micro-instructions in total.\nBut hopefully you've found this look at the circuitry interesting.</p>\n<p>Disclaimer: this should all be viewed as slightly speculative and there are probably some errors.\nI didn't want to prefix every statement with \"I think that...\" but you should pretend it is there.\nI plan to write more about the implementation of the Pentium, so\nfollow me on Bluesky (<a href=\"https://bsky.app/profile/righto.com\">@righto.com</a>) or <a href=\"https://www.righto.com/feeds/posts/default\">RSS</a> for updates.\nPeter Bosch has done some reverse engineering of the Pentium II microcode; his information is <a href=\"https://pbx.sh/pentiumii-part1/\">here</a>.</p>\n<h2>Footnotes and references</h2>\n<div class=\"footnote\">\n<ol>\n<li id=\"fn:ambiguity\">\n<p>It is arbitrary if a transistor corresponds to a 0 bit or a 1 bit. A transistor will pull the output line low (i.e. a 0 bit),\nbut the signal could be inverted before it is used.\nMore analysis of the circuitry or ROM contents would clear this up.&#160;<a class=\"footnote-backref\" href=\"#fnref:ambiguity\" title=\"Jump back to footnote 1 in the text\">&#8617;</a></p>\n</li>\n<li id=\"fn:contacts\">\n<p>When looking at a ROM like this, the contact pattern seems like it should tell you the contents of the ROM.\nUnfortunately, this doesn't work. Since a contact can be attached to one or two transistors, the contact\npattern doesn't give you enough information.\nYou need to see the silicon to determine the transistor pattern and thus the bits.&#160;<a class=\"footnote-backref\" href=\"#fnref:contacts\" title=\"Jump back to footnote 2 in the text\">&#8617;</a></p>\n</li>\n<li id=\"fn:simplified-rows\">\n<p>I simplified the row driver schematic. The most interesting difference is that the NAND gates are optimized to use three\ntransistors each, instead of four transistors. The trick is that one of the NMOS transistors is essentially shared across\nthe group of 8 drivers; an inverter drives the low side of all eight gates.\nThe second simplification is that the 6-input AND gate is implemented with two 3-input NAND gates and a NOR gate for\nelectrical reasons.</p>\n<p>Also, the decoder that converts 3 bits into 8 select lines is located between the banks, at the right, not at\nthe top of the ROM as I showed in the schematic.\nLikewise, the inverters for the 6 row-select bits are not at the top.\nInstead, there are 6 inverters and 6 buffers arranged in a column to the right of the ROM, which works better for the layout.\nThese are BiCMOS drivers so they can provide the high-current outputs necessary for the long wires and numerous\ntransistor gates that they must drive.&#160;<a class=\"footnote-backref\" href=\"#fnref:simplified-rows\" title=\"Jump back to footnote 3 in the text\">&#8617;</a></p>\n</li>\n<li id=\"fn:binary\">\n<p>The inputs to the 6-input AND gate are arranged in a binary counting pattern, selecting each row in sequence.\nThis binary arrangment is standard for a ROM's decoder circuitry and is a good way to recognize a ROM on a die.\nThe Pentium has 36 row decoders, rather than the 64 that you'd expect from a 6-bit input. The ROM was made to the size\nnecessary, rather than a full power of two.\nIn most ROMs, it's difficult to determine if the ROM is addressed bottom-to-top or top-to-bottom.\nHowever, because the microcode ROM's counting pattern is truncated, one can see that the top bank starts with 0 at the top\nand counts downward, while the bottom bank is reversed, starting with 0 at the bottom and counting upward.&#160;<a class=\"footnote-backref\" href=\"#fnref:binary\" title=\"Jump back to footnote 4 in the text\">&#8617;</a></p>\n</li>\n<li id=\"fn:mux\">\n<p>A note to anyone trying to read the ROM contents: it appears that the order of entries in a group of 16 is inconsistent,\nso a straightforward attempt to visually read the ROM will end up with scrambled data.\nThat is, some of the groups are reversed. I don't see any obvious pattern in which groups are reversed.</p>\n<p><a href=\"https://static.righto.com/images/pentium-microcode1/output-mux-detail.jpg\"><img alt=\"A closeup of the first stage output mux. This image shows the M1 metal layer.\" class=\"hilite\" height=\"319\" src=\"https://static.righto.com/images/pentium-microcode1/output-mux-detail-w600.jpg\" title=\"A closeup of the first stage output mux. This image shows the M1 metal layer.\" width=\"600\" /></a><div class=\"cite\">A closeup of the first stage output mux. This image shows the M1 metal layer.</div></p>\n<p>In the diagram above, look at the contacts from the select lines, connecting the select lines to the mux transistors.\nThe contacts on the left are the mirror image of the contacts on the right, so the columns will be accessed in the opposite\norder.\nThis mirroring pattern isn't consistent, though; sometimes neighboring groups are mirrored and sometimes they aren't.</p>\n<p>I don't know why the circuitry has this layout. Sometimes mirroring adjacent groups makes the layout more efficient, but\nthe inconsistent mirroring argues against this. Maybe an automated layout system decided this was the best way.\nOr maybe Intel did this to provide a bit of obfuscation against reverse engineering.&#160;<a class=\"footnote-backref\" href=\"#fnref:mux\" title=\"Jump back to footnote 5 in the text\">&#8617;</a></p>\n</li>\n</ol>\n</div>",
  "id": "tag:blogger.com,1999:blog-6264947694886887540.post-3129002752159663932"
}